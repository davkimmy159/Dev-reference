`instanceof` 로 클래스 확인하기
=============================

- 객체의 클래스 타입 확인
- 상속 관계 확인

<br />

- 문법
```javascript
obj instanceof Class
```
- `obj` 타입 확인
  - `Class` · `Class` 상속 클래스
- 반환 값
  - 불린형
```javascript
class Rabbit {}
let rabbit = new Rabbit();

// rabbit (객체) : Rabbit (클래스)
// - 클래스 타입 확인
alert( rabbit instanceof Rabbit ); // true
```
- 생성자 함수
```javascript
function Rabbit() {}
let rabbit = new Rabbit();

// rabbit (객체) : Rabbit (생성자 함수)
// - 생성자 함수 타입 확인
alert( rabbit instanceof Rabbit ); // true
```
- 내장 클래스
```javascript
let arr = [1, 2, 3];
alert( arr instanceof Array );  // true
alert( arr instanceof Object ); // true

// Array → Object 상속
// - 프로토타입 기반
```
- 보통 프로토타입 체인 올라가며 확인
- `[Symbol.hasInstance]` <sub>(정적 메서드)</sub>
  - 직접 확인 로직 설정

#### `obj instanceof Class` 알고리즘
- `[Symbol.hasInstance]` <sub>(정적 메서드)</sub> 

##### 1. 구현 시
- `Class[Symbol.hasInstance](obj)` 호출
  - `true` · `false` 반환
- `instanceof` 동작 커스터마이징
```javascript
// instanceOf 로직 직접 설정
// - canEat (프로퍼티) 존재 시 animal 이라고 판단
class Animal {
  static [Symbol.hasInstance](obj) {
    if (obj.canEat) return true;
  }
}

let obj = { canEat: true };

alert(obj instanceof Animal); // true, Animal[Symbol.hasInstance](obj) 호출
```

##### 2. 미구현 시
- 일반적인 로직 사용
  - 대부분의 클래스 미구현
- `Class.prototype` 일치 여부 확인
  - `obj` 프로토타입 체인 상 프로토타입 중 하나인지
  - 차례 차례 비교 진행
```javascript
obj.__proto__ === Class.prototype?
obj.__proto__.__proto__ === Class.prototype?
obj.__proto__.__proto__.__proto__ === Class.prototype?
...
/*
 이 중 하나라도 true
 - true 반환
 체인 끝 도달
 - false 반환
 */
```
- 상속 클래스
  - 2번째 단계에서 일치 여부 확인
```javascript
class Animal {}
class Rabbit extends Animal {}

let rabbit = new Rabbit();
alert(rabbit instanceof Animal); // true

// rabbit.__proto__ === Rabbit.prototype
// rabbit.__proto__.__proto__ === Animal.prototype (일치)
```

![instanceof](../../images/09/06/instanceof.svg)

#### `isPrototypeOf` <sub>(메서드)</sub>
```javascript
proto.isPrototypeOf(obj)
```

##### `proto` <sub>(프로토타입)</sub>
- `obj` <sub>(객체)</sub> 프로토타입 체인 상 어딘가 존재 시
  - `true` 반환
```javascript
// 동일
obj instanceof Class;
Class.prototype.isPrototypeOf(obj);
```

##### 검사 시 Class 생성자 제외
- 2가지만 고려
  - 프로토타입 체인
  - `Class.prototype`
- 객체 생성 후 `prototype` <sub>(프로퍼티)</sub> 변경 시
  - 특이한 결과 초래
```javascript
function Rabbit() {}
let rabbit = new Rabbit();

// 프로토타입 변경
Rabbit.prototype = {};

// 더 이상 Rabbit 아님
alert( rabbit instanceof Rabbit ); // false
```

### 보너스: 타입 확인 위한 `Object.prototype.toString`
- 일반 객체 → 문자열 변환 시
  - `"[object Object]"`
```javascript
let obj = {};

alert(obj);            // "[object Object]"
alert(obj.toString()); // "[object Object]"
```
- `toString` 숨겨진 기능 사용 시
  - `typeof` 확장
  - `instanceof` 대안
- `toString` <sub>(내장 메서드)</sub> 추출 가능
  - 명세서 정의
  - 모든 값 대상 실행 가능
  - 호출 결과
    - 값 따라 상이

|타입|문자열 변환|
|---|---|
|숫자형|`"[object Number]"`|
|불린형|`"[object Boolean]"`|
|null|`"[object Null]"`|
|undefined|`"[object Undefined]"`|
|배열|`"[object Array]"`|
|그외|커스터마이징 가능|

```javascript
// toString (메서드)
// - 편의 위해 변수에 복사
let objectToString = Object.prototype.toString;

let arr = [];

alert( objectToString.call(arr) ); // [object Array]
```
- `toString` 알고리즘
  - 내부적으로 `this` 검사 후
    - 상응 결과 반환
```javascript
let s = Object.prototype.toString;

alert( s.call(123) );   // [object Number]
alert( s.call(null) );  // [object Null]
alert( s.call(alert) ); // [object Function]
```

#### `Symbol.toStringTag` <sub>(프로퍼티)</sub>
- `toString` 동작 커스터마이징
```javascript
let user = {
  [Symbol.toStringTag]: "User"
};

alert( {}.toString.call(user) ); // [object User]
```
- 대부분 호스트 환경
  - 자체 객체에 유사 프로퍼티 구현
```javascript
// toStringTag
// - 특정 호스트 환경의 객체 · 클래스에 구현
alert( window[Symbol.toStringTag]); // Window
alert( XMLHttpRequest.prototype[Symbol.toStringTag] ); // XMLHttpRequest

alert( {}.toString.call(window) );  // [object Window]
alert( {}.toString.call(new XMLHttpRequest()) );       // [object XMLHttpRequest]
```

##### `toString` · `toStringTag`
- `typeof` <sub>(연산자)</sub> 강력한 변형들
- 내장 객체
  - 사용 · 커스터마이징 가능
- 타입 정보 문자열 필요 시
  - `instanceof` X
  - `{}.toString.call`

#### 확인 메서드
||동작대상|반환값|
|---|---|---|
|`typeof`|원시형|문자열|
|`instanceof`|객체|`true` · `false`|
|`{}.toString`|- 원시형<br />- 내장 객체<br />- `Symbol.toStringTag` 보유 객체|문자열|
- `{}.toString`
  - `typeof` 보다 더 많은 기능 보유
