모듈 소개
========

##### 분리된 파일 각각
- 클래스 하나
- 라이브러리 하나
  - 특정 목적 복수 함수

##### JS 초기
- 모듈 필요 X
  - 스크립트 크기 小
  - 기능 단순

##### JS 현재
- 모듈 필요성 ↑
  - 스크립트 크기 大
  - 기능 복잡

#### 모듈 라이브러리

##### AMD
- 가장 오래된 모듈 시스템 중 하나
  - require.js <sub>(라이브러리)</sub> 통해 처음 개발

##### CommonJS
- Node.js 서버 용도

##### UMD
- 다양한 모듈 시스템 함께 사용
  - AMD
  - CommonJS
  - 기타 등등

##### JS 모듈 시스템
- 2015년 표준 등재
- 대부분의 주요 브라우저 · Node.js
  - 모듈 시스템 지원

### 모듈이란
- 단지 파일 하나
- 스크립트 하나 == 모듈 하나

##### 특수 지시자
- `export` <sub>(모듈 내보내기)</sub>
  - 외부 모듈
    - 해당 변수 · 함수 접근
- `import` <sub>(모듈 가져오기)</sub>
  - 외부 모듈 기능 가져오기

```javascript
/*
 export (지시자)
 - sayHi.js (파일) 내부 sayHi (함수)
   - 외부 내보내기
 📁 sayHi.js
 */
export function sayHi(user) {
  alert(`Hello, ${user}!`);
}
```
```javascript
/*
 import (지시자)
 - `main.js` (파일)
   - `sayHi` (함수) 가져오기 · 사용
 📁 main.js
 */
import {sayHi} from './sayHi.js';

alert(sayHi);  // 함수
sayHi('John'); // Hello, John!
```

##### `import` <sub>(지시자)</sub>
- 모듈 가져오기
  - `"./sayHi.js"` <sub>(상대 경로)</sub> 기준
  - `sayHi` <sub>(함수)</sub>
    - 상응 변수에 할당

##### 브라우저 내 모듈 동작
- 특수 키워드 · 기능 함께 사용
- `<script type="module">`
  - `"module"` 속성 설정
  - 해당 스크립트 == 모듈 <sub>(브라우저 인지)</sub>

```html
<!-- index.html -->
<!doctype html>
<script type="module">
  import { sayHi } from './say.js';

  document.body.innerHTML = sayHi('John');
</script>
```
```javascript
// 📁 main.js
export function sayHi(user) {
  return `Hello, ${user}!`;
}
```
```javascript
// 결과
Hello, John!
```

##### 브라우저
- 자동으로 모듈 가져오고 평가 후 실행

<img class="icon" src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **모듈 : 로컬 파일 X, HTTP · HTTPS <sub>(프로토콜)</sub> 통해서만 동작**

##### `file://` 프로토콜 <sub>(로컬)</sub>
- `import` · `export` <sub>(지시자)</sub> 동작 X

##### HTTP · HTTPS
- 정상 동작
  - `static-server` <sub>(로컬 웹 서버)</sub>
  - 라이브 서버 익스텐션 <sub>(코드 에디터)</sub>
  - 기타 등등

### 모듈 핵심 기능
- 모든 호스트 환경 공통 적용

#### 항상 엄격 모드 실행
```html
<script type="module">
  a = 5; // 에러
</script>
```

#### 모듈 레벨 스코프
- 모듈 자신만의 스코프 존재
- 모듈 내부 정의 변수 · 함수
  - 외부 스크립트 접근 X

##### 예시
- 가져오기
  - user.js
  - hello.js
- user.js 선언 변수 <sub>(`user`)</sub>
  - hello.js 사용 시
    - 에러 발생
```html
<!-- index.html -->
<!doctype html>
<script type="module" src="user.js"></script>
<script type="module" src="hello.js"></script>
```
```javascript
// 📁 user.js
let user = "John";
```
```javascript
// 📁 hello.js
// 모듈 : 변수 공유 X
// - 에러 발생
// - `Uncaught ReferenceError: user is not defined`
alert(user);
```
```javascript
// 결과
```
- 모듈 외부 공개
  - `export`
- 내보내진 모듈 가져와 사용
  - `import`

```html
<!-- index.html -->
<!doctype html>
<script type="module" src="hello.js"></script>
```
```javascript
// 📁 user.js
export let user = "John";
```
```javascript
// 📁 hello.js
import {user} from './user.js';

document.body.innerHTML = user; // John
```
```javascript
// 결과
John
```

##### 브라우저 환경
- 모듈 생성 시 <sub>(`<script type="module">`)</sub>
  - 독립적인 스코프 생성
```html
<script type="module">
  // 해당 모듈 안에서만 접근 가능
  let user = "John";
</script>

<script type="module">
  // Error: user is not defined
  alert(user);
</script>
```

##### `window` 레벨 전역 변수 생성 시 <sub>(브라우저 환경)</sub>
- 명시적 변수 할당 · 접근
  - 정말 필요한 경우에만 사용
```javascript
window.user = "user";
alert(window.user);
```

### 단 한 번만 평가됨

##### 최초 호출 시 단 한 번만 실행
- 동일 모듈 여러 곳 사용 상관 X
- 실행 후 결과
  - 가져가려는 모든 모듈에 보내짐
- 이런 작동 방식
  - 중요한 결과 초래

##### 예시 : alert.js <sub>(모듈)</sub>
- `alert` <sub>(함수)</sub> 실행
- 여러 모듈에서 가져오기
  - 얼럿 창 : 단 한 번만 표시
```javascript
// 📁 alert.js
alert("모듈이 평가되었습니다!");
```
```javascript
// 동일 모듈
// - 여러 모듈에서 가져오기

// 📁 1.js
import `./alert.js`; // "모듈이 평가되었습니다!"

// 📁 2.js
import `./alert.js`; //
```

##### 실무 : 최상위 레벨 모듈
- 초기화
- 내부 사용 데이터 구조 생성 후
  - 내보내 재사용

##### 예시 : 객체 내보내는 모듈
```javascript
/*
 최초 호출 시 단 한 번만 평가
 - admin (객체) 생성
 이 모듈 가져오는 모든 모듈
 - 동일 admin (객체) 전달
 */
// 📁 admin.js
export let admin = {
  name: "John"
};
```
```javascript
/*
 각 모듈
 - 모두 같은 객체 가져옴
   - 1.js : 객체 조작
   - 2.js : 객체 조작 확인
 */

// 📁 1.js
import {admin} from './admin.js';
admin.name = "Pete";

// 📁 2.js
import {admin} from './admin.js';
alert(admin.name); // Pete
```
##### 모듈 : 단 한 번만 실행
- 실행된 모듈
  - 필요한 곳에 공유
- 어느 한 모듈 : 수정
  - 다른 모듈 : 변경사항 확인

##### 모듈 설정 용이
- 최초 실행 모듈 객체 프로퍼티
  - 원하는 대로 설정
- 다른 모듈
  - 설정 그대로 사용

##### 예시 : admin.js <sub>(모듈)</sub>
- 어떤 특정 기능 제공
- `admin` <sub>(객체)</sub> 관련 외부 인증 정보 필요
```javascript
// 📁 admin.js
export let admin = { };

export function sayHi() {
  alert(`${admin.name}님, 안녕하세요!`);
}
```

##### init.js
- 최초 실행 스크립트
  - `admin.name` 설정
- 외부 스크립트 <sub>(admin.js 포함)</sub>
  - `admin.name` 정보 사용
```javascript
// 📁 init.js
import {admin} from './admin.js';
admin.name = "보라";
```
```javascript
// 📁 other.js
import {admin, sayHi} from './admin.js';

alert(admin.name); // 보라

sayHi(); // 보라님, 안녕하세요!
```

### import.meta <sub>(객체)</sub>
- 현재 모듈 정보 제공
- 제공 정보 내용
  - 호스트 환경 따라 상이

##### 브라우저 환경
- 스크립트 URL 정보
- HTML 내 모듈
  - 웹페이지 <sub>(현재 실행 중)</sub> URL 정보
```html
<script type="module">
  // script URL (html 페이지 URL)
  // - 인라인 스크립트 위치
  alert(import.meta.url);
</script>
```

### `this` == `undefined`
- 모듈 최상위 레벨 `this`
  - `undefined`
- 일반 스크립트 `this`
  - 전역 객체
```html
<script>
  alert(this); // window
</script>

<script type="module">
  alert(this); // undefined
</script>
```

### 브라우저 특정 기능
- `type="module"` <sub>(속성)</sub>

#### 지연 실행
- 외부 · 인라인 관계 X
- `defer` <sub>(속성)</sub> 같이 실행
  - "defer, async 스크립트" <sub>(챕터)</sub>

##### 특징
- 외부 모듈 스크립트 : 모듈 다운로드 시
  - `<script type="module" src="…">`
  - 브라우저
    - HTML 처리 중단 X
    - 병렬적으로 불러옴
      - 외부 모듈 스크립트
      - 기타 리소스
- 모듈 스크립트
  - HTML 문서 완전 준비 때까지 대기 상태
  - HTML 문서 완전 생성 이후 실행
    - 문서보다 빨리 불러온 경우 포함
      - 모듈 크기 小
- 스크립트 상대적 순서 유지
  - 위쪽 <sub>(문서 상)</sub> 스크립트부터 차례로 실행

##### 특징 결과
- 항상 완전한 HTML 페이지
  - 볼 수 있음
  - 문서 내 요소 접근 가능
```html
<!-- 모듈 스크립트 -->
<script type="module">
  /*
   지연 실행
   페이지 완전 로드 후
   - alert (함수) 실행
     - object 출력
   아래쪽 button (요소)
   - '볼 수' 있음
   */
  alert(typeof button);
</script>

<!-- 일반 스크립트 -->
<script>
  /*
   즉시 실행
   페이지 완전 로드 전
   - button (요소) 접근
     - undefined 출력
   */
  alert(typeof button);
</script>

<!-- button 요소 -->
<button id="button">Button</button>
```

##### 일반 스크립트
- 1번째 모듈 스크립트보다 먼저 실행
- 위 예시 출력 순서
  1. `undefined`
  2. `object`

#### 주의점

##### 모듈 스크립트
- HTML 페이지 완전히 로딩 후 실행

##### 페이지 내 특정 기능 : 모듈 스크립트 의존
- 모듈 완전 로딩 전 페이지 노출
  - 사용자 혼란
- 모듈 스크립트 로딩 동안
  - 사용자 혼란 예방
    - 투명 오버레이 표시
    - 로딩 인디케이터 표시

#### 인라인 스크립트 비동기 처리

##### `async` <sub>(속성)</sub>

##### 일반 스크립트
- 외부 스크립트 불러올 때만 유효
- 로딩 완료 시
  - 즉시 실행
  - 대기 X
    - 다른 스크립트
    - HTML 문서 처리
    - 기타 등등

##### 인라인 모듈 스크립트
- 가져오기 작업 종료 시
  - 모듈 즉시 실행
  - 대기 X
    - HTML 파싱
    - 다른 스크립트 대기 상태
    - 기타 등등
- 독립 <sub>(종속 X)</sub> 기능 구현 시 유용
  - 광고
  - 문서 레벨 이벤트 리스너
  - 카운터
  - 기타 등등
```html
<!-- 필요한 모듈(analytics.js)의 로드가 끝나면 -->
<!-- 문서나 다른 <script>가 로드되길 기다리지 않고 바로 실행됩니다.-->
<script async type="module">
  import {counter} from './analytics.js';

  counter.count();
</script>
```