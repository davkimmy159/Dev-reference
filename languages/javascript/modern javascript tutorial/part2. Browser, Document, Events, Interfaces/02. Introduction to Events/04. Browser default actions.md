브라우저 기본 동작
=================

#### 상당수 이벤트
- 발생 즉시 특정 동작 자동 수행 <sub>(브라우저)</sub>

##### ex\)
- 링크 클릭 시
  - 해당 URL 이동
- 폼 전송 버튼 클릭 시
  - 서버에 폼 전송
- 마우스 버튼 누른 채로 글자 위 커서 이동 시
  - 글자 선택
- 기타 등등

### 브라우저 기본 동작 막기

1. `addEventListener` <sub>(메서드)</sub>
    - `event.preventDefault()`
2. `on<event>` <sub>(HTML 속성 · DOM 프로퍼티)</sub>
    - `false` 반환

##### ex\) 링크 <sub>(`<a>`)</sub> 기본 동작 막기
- 클릭 시 해당 URL 이동 X
```html
<a href="/" onclick="return false">이곳</a>을 클릭해주세요.
<a href="/" onclick="event.preventDefault()">이곳을</a> 클릭해주세요.
```

![preventing-browser-basic-operation](../../images/02/02/04/preventing-browser-basic-operation.png)

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **핸들러 `false` 반환 : 예외 상황**

##### 이벤트 핸들러 반환값
- 대개 무시

##### 예외사항
- `on<event>` <sub>(HTML 속성 · DOM 프로퍼티)</sub>
  - `false` 반환 시
    - 기본 동작 막음

<br />

#### 메뉴 구현하기 <sub>(약간의 CSS 추가)</sub>
```html
<ul id="menu" class="menu">
  <li><a href="/html">HTML</a></li>
  <li><a href="/javascript">JavaScript</a></li>
  <li><a href="/css">CSS</a></li>
</ul>
```

![implementing-menu](../../images/02/02/04/implementing-menu.png)

##### 각 항목
- `<button>` <sub>(태그)</sub> X
- `<a>` <sub>(태그)</sub> 사용
  - 마우스 우측 버튼 → '새 창에서 열기'
    - `<button>` · `<span>` X
- 검색 엔진
  - 인덱싱 <sub>(색인)</sub> 중
    - `<a href="…">` <sub>(링크)</sub> 따라감

##### JS 브라우저 기본 동작 취소
```javascript
// 이벤트 위임 사용 (유연한 코드)
// - 중첩 메뉴 추가 용이
// - CSS 적용 용이
menu.onclick = function(event) {
  if (event.target.nodeName != 'A') return;

  let href = event.target.getAttribute('href');

  /* href 값 (URL) 이용해 작업
   서버 데이터 읽어오기
   새 UI 생성
   기타 등등
   */
  alert( href );

  // 브라우저 동작 취소 (URL 이동 X)
  // 생략 시 기본 동작 수행 (URL 이동)
  return false;
};
```

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **후속 이벤트**

#### 몇몇 순차적 발생 이벤트 존재
- 1번째 이벤트 막을 시
  - 2번째 이벤트 미발생

##### ex\) `mousedown` <sub>(`<input>` 필드 이벤트)</sub>
- `focus` <sub>(이벤트)</sub> 유발
  - 앞 이벤트 막으면 미발생

##### ex\) `<input>` <sub>(필드)</sub>
- 1번째 필드 클릭 시
  - `focus` <sub>(이벤트)</sub> 발생
- 2번째 필드 클릭 시
  - `focus` <sub>(이벤트)</sub> 미발생
```html
<input value="focus가 동작합니다," onfocus="this.value=''">

<!-- mousedown (이벤트)
브라우저 기본 동작 취소
- return false
우회 방법
- 1번째 필드 포커스 중 Tab (키) 누르기
  - 2번째 필드 포커스 이동
-->
<input onmousedown="return false" onfocus="this.value=''" value="클릭해 주세요.">
```

![following-event](../../images/02/02/04/following-event.png)

<br />

### `'passive'` <sub>(`addEventListener` 옵션)</sub>

##### 브라우저에 정보 알림
- `preventDefault()` 미호출

#### 용도

##### ex\) `touchmove` <sub>(모바일 기기 브라우저 이벤트)</sub>
- 스크린 위 손가락 대고 이동 시
  - 스크롤링 발생
- `preventDefault()` 사용 시
  - 스크롤링 막힘

##### 스크롤링 유발 이벤트 감지 시 <sub>(모바일 기기 브라우저)</sub>
- 먼저 모든 핸들러 처리
- `preventDefault` 미호출 판단 시
  - 그제야 스크롤링 진행
    - 불필요 지연 발생
    - 화면 '덜덜 떨리는' 현상 발생

##### `passive: true` <sub>(옵션 설정)</sub>
- 브라우저에 정보 알림
  - 핸들러 : 스크롤링 취소 X
- 브라우저
  - 화면 최대한 자연스럽게 스크롤링
  - 이벤트 적절히 처리
- 일부 브라우저 <sub>(Firefox · Chrome 등)</sub>
  - `touch[start·move]` <sub>(이벤트)</sub> 기본값

### `event.defaultPrevented`

##### 기본 동작
- 막은 경우
  - `true`
- 막지 않은 경우
  - `false`

#### 흥미로운 유스 케이스
- `event.stopPropagation()`
  - 버블링 막음
- `event.defaultPrevented`
  - 다른 이벤트에 알림
    - 이벤트 적절히 처리 완료

##### ex\) `contextmenu` <sub>(이벤트)</sub>
- 브라우저 내 마우스 우측 버튼 클릭 시
  - 컨텍스트 메뉴 표시
  - 대신 다른 것 표시 가능
```html
<!-- 버튼 (요소) 적용 -->
<button>마우스 우측 버튼을 클릭하면 컨텍스트 메뉴가 뜹니다.</button>
<button oncontextmenu="alert('커스텀 메뉴가 뜨네요!'); return false">
  여기서 마우스 우측 버튼을 클릭해보세요.
</button>
```

![event-defaultPrevented-1](../../images/02/02/04/event-defaultPrevented-1.png)

```html
<!-- 문서 레벨 적용 -->
<p>문서 레벨 컨텍스트 메뉴</p>
<button id="elem">버튼 레벨 컨텍스트 메뉴</button>

<script>
  elem.oncontextmenu = function(event) {
    event.preventDefault();
    alert("버튼 컨텍스트 메뉴");
  };

  document.oncontextmenu = function(event) {
    event.preventDefault();
    alert("문서 컨텍스트 메뉴");
  };
</script>
```

![event-defaultPrevented-2](../../images/02/02/04/event-defaultPrevented-2.png)

##### 문서 레벨 적용 개선점
- `elem` <sub>(요소)</sub> 클릭 시
  - 컨텍스트 메뉴 2개 표시 <sub>(이벤트 버블링)</sub>
    - `elem` <sub>(요소)</sub>
    - `document` <sub>(문서)</sub>

#### 해결

##### ① `event.stopPropagation()`
- `elem` <sub>(요소)</sub> 버블링 막기
- 외부 코드
  - `elem` <sub>(요소)</sub> 마우스 클릭 정보 접근 X
```html
<p>문서 레벨 컨텍스트 메뉴</p>
<button id="elem">버튼 레벨 컨텍스트 메뉴(event.stopPropagation를 사용해 버그 수정)</button>

<script>
  elem.oncontextmenu = function(event) {
    event.preventDefault();

    // 버블링 막기
    event.stopPropagation();
    alert("버튼 컨텍스트 메뉴");
  };

  document.oncontextmenu = function(event) {
    event.preventDefault();
    alert("문서 컨텍스트 메뉴");
  };
</script>
```

![event-defaultPrevented-3](../../images/02/02/04/event-defaultPrevented-3.png)

##### ② `event.defaultPrevented`
- `document` <sub>(요소)</sub> 핸들러
  - 기본 동작 막힘 여부 확인
```html
<p>문서 레벨 컨텍스트 메뉴(event.defaultPrevented를 확인함)</p>
<button id="elem">버튼 레벨 컨텍스트 메뉴</button>

<script>
  elem.oncontextmenu = function(event) {
    event.preventDefault();
    alert("버튼 컨텍스트 메뉴");
  };

  document.oncontextmenu = function(event) {

    // 기본 동작 막힌 경우
    // - 이벤트 처리 X
    if (event.defaultPrevented) return;

    event.preventDefault();
    alert("문서 컨텍스트 메뉴");
  };
</script>
```

![event-defaultPrevented-4](../../images/02/02/04/event-defaultPrevented-4.png)

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **`stopPropagation` vs `preventDefault`**

##### 명백히 다른 메서드
- 연관성 X

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **중첩 컨텍스트 메뉴 아키텍처**

##### 다른 구현 방법
- `document.oncontextmenu` 전용 핸들러
  - 전역 객체 내 구현
  - 다른 핸들러 저장
- 전역 객체
  - 모든 우클릭 잡음
    - 적절한 내부 핸들러 실행

##### 단점
- 컨텍스트 메뉴 관련 각 코드 조각
  - 해당 객체 알고 있어야 함
  - 자체 `contextmenu` 핸들러 X
    - 해당 객체 의존

<br />

## 요약

#### 각 이벤트 대응 브라우저 기본 동작

##### `mousedown`
- 마우스 이동 위치 선택 시작

##### `<input type="checkbox">` <sub>(요소)</sub> 클릭
- `input` <sub>(필드)</sub> 선택 · 해제

##### `submit`
- 폼 내 `<input type="submit">` 클릭 · Enter <sub>(키)</sub>
  - 폼 → 서버 전송

##### `keydown`
- 키 누름
  - 텍스트 박스 내 글자 추가
  - 이 외 다른 동작 수행

##### `contextmenu`
- 마우스 우측 버튼 클릭
  - 브라우저 컨텍스트 메뉴 표이
  - 이 외 다양한 기본 동작 수행

#### 이벤트 막기

##### `addEventListener` <sub>(메서드)</sub>
- `event.preventDefault()`
 
##### `on<event>` <sub>(HTML 속성 · DOM 프로퍼티)</sub>
- `return false`

##### `passive: true` <sub>(옵션)</sub>
- `addEventListener` <sub>(메서드)</sub> 옵션
  - 브라우저에 정보 <sub>(기본 동작 막지 않음)</sub> 알림
- `touch[start·move]` <sub>(이벤트)</sub> 처리 시 유용
  - 모바일 기기 브라우저
  - 스크롤링 시작 시 모든 핸들러 처리 X
 
##### `on<event>` <sub>(HTML 속성 · DOM 프로퍼티)</sub>
- `return false`

##### `event.defaultPrevented` 값
- 기본 동작
  - 막은 경우
    - `true`
  - 막지 않은 경우
    - `false`

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **기본 동작 막기를 너무 남용하지 마세요.**

기본 동작을 막는 자바스크립트 코드를 추가하면 제약 없이 요소의 동작을 원하는 대로 바꿀 수 있습니다. 링크 `<a>`를 버튼처럼 만들 수 있고, 버튼 `<button>`을 다른 URL로 이동시켜주는 링크처럼 동작하게 할 수도 있습니다.

하지만 HTML 요소의 의미를 지키면서 동작을 바꿔야 합니다. `<a>`는 페이지를 돌아다니는 동작을 해야 하지 버튼처럼 동작해선 안 됩니다.

이렇게 요소가 가진 의미를 해치지 않으면서 코드를 작성하면 '좋은 코드'가 될 뿐만 아니라 접근성 측면에서도 도움이 됩니다.

`<a>`와 기본동작 막기를 조합한 코드를 구상할 때 주의할 것이 있습니다. 사용자는 브라우저 기본 동작을 사용해 마우스 우클릭 등의 방법으로 새 창에서 링크를 열 수 있습니다. 이 기능은 인기가 많죠. 하지만 자바스크립트로 버튼을 조작해 링크처럼 동작하게 만들고 CSS를 이용해 버튼을 링크처럼 꾸미더라도 브라우저에서 제공하는 `<a>` 관련 기능은 버튼에선 작동하지 않습니다.

<br />

## <img src="../../images/commons/icons/circle-check-solid.svg" /> 과제

### 왜 `'return false'`가 작동하지 않을까요
아래의 코드에서 `return false`는 왜 전혀 작동하지 않을까요?
```html
<script>
  function handler() {
    alert( "..." );
    return false;
  }
</script>

<a href="https://w3.org" onclick="handler()">브라우저가 w3.org로 이동합니다.</a>
```

![assignment-why-return-false-not-functioning](../../images/02/02/04/assignment-why-return-false-not-functioning.png)

브라우저에서 링크를 클릭하면 해당 URL로 이동하는데, 이 기본동작을 취소하고 싶다고 해봅시다.

어떻게 코드를 수정하면 될까요?

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

브라우저는 `onclick` 같은 `on*` 속성을 읽을 때, 속성값을 그대로 가져와 핸들러를 생성합니다.

따라서 `onclick="handler()`"의 경우 생성되는 핸들러 함수는 다음과 같습니다.
```javascript
function(event) {
  handler() // onclick 속성에 할당된 값이 그대로 핸들러 함수 본문이 됩니다.
}
```

그런데 여기서 보면 함수 `handler`를 괄호를 붙여서 호출하기만 했지, 호출시 반환된 값은 그 어디에서도 사용하지 않고 있습니다. 따라서 아무런 변화가 없습니다.

우리가 원하는 대로 링크로 이동하지 않게 하려면 다음과 같이 코드를 수정하면 됩니다.
```html
<script>
  function handler() {
    alert("...");
    return false;
  }
</script>

<a href="https://w3.org" onclick="return handler()">w3.org</a>
```

이 외에도 `event.preventDefault()`를 사용할 수 있습니다.
```html
<script>
  function handler(event) {
    alert("...");
    event.preventDefault();
  }
</script>

<a href="https://w3.org" onclick="handler(event)">w3.org</a>
```

<hr />

### 요소 안 링크 잡아내기
사용자가 `id`가 `contents`인 요소 안에 있는 링크를 클릭했을 때 정말 사이트를 떠나 해당 링크로 갈지를 물어보는 기능을 구현해봅시다. 그리고 사용자가 사이트를 떠나지 않겠다고 하면, 사이트에 남아있어야 합니다.

예시:

![assignment-catching-link-in-element](../../images/02/02/04/assignment-catching-link-in-element.png)

주의사항:
- 요소 안 HTML은 언제든지 동적으로 로드되거나 재생성될 수 있습니다. 따라서 모든 링크를 찾아 핸들러를 적용할 수 없습니다. 그러니 이벤트 위임을 사용해 답안을 작성해보세요.
- `id`가 `contents`인 요소 안에는 중첩 태그가 있을 수 있습니다. 링크 안에도 마찬가지로 `<a href="…"><i>…</i></a>` 이렇게 중첩 태그가 존재할 수 있습니다.

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

이 문제는 이벤트 위임 패턴을 잘 활용할 수 있는 문제입니다.

사용자에게 현재 페이지를 떠날 것인지 물어보는 대신, 방문자가 떠난 위치를 저장하는 서버에 'logging' 요청을 보낼 수 있습니다. 가능하다면 내용을 불러와서 현재 페이지에 바로 보이게 하는 방법을 사용할 수도 있습니다.

그러니까 `contents.onclick`를 잡아낸 다음, 사용자에게 물어보기 위해 `confirm`을 사용하기만 하면 됩니다. URL에 `link.href` 대신 `link.getAttribute('href')`를 사용하는 것이 더 좋은 방법입니다. 자세한 사항은 샌드박스의 해답에서 확인해보세요.

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/uBMDMDDf8mIiCQRV?p=preview)

<hr />

### 이미지 갤러리
섬네일(thumbnail)을 클릭하면 이미지가 바뀌는 이미지 갤러리를 만들어보세요.

예시:

![assignment-image-gallery](../../images/02/02/04/assignment-image-gallery.png)

P.S. 이벤트 위임을 사용하세요.

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

상위 요소에 핸들러를 할당하면 어떤 이미지를 클릭했는지 추적할 수 있습니다. 사용자가 `<a>` 링크를 클릭한 경우, `#largeImg`의 `src` 값을 섬네일의 `href`로 변경하면 됩니다.

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/0rOQcjAnTYfIt7Lm?p=preview)
