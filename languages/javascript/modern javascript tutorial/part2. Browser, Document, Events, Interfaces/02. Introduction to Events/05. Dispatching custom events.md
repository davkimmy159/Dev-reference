커스텀 이벤트 디스패치
====

##### JS
- 새 이벤트 직접 생성 가능
  - 내장 이벤트
  - 커스텀 이벤트

##### 내장 이벤트 <sub>(테스팅 자동화 용이)</sub>
- `click`
- `mousedown`
- 기타 등등

##### 커스텀 이벤트 <sub>(그래픽 컴포넌트 작성 시 사용)</sub>
- 표준 외 새 이벤트
- ex\) 메뉴 <sub>(JS 기반)</sub>
  - 루트 요소 커스텀 이벤트 생성
    - `open` <sub>(메뉴 열기)</sub>
    - `select` <sub>(항목 선택)</sub>
    - 기타 등등
  - 외부 코드
    - 핸들러 통해 동작 파악

### `Event` 생성자

##### 내장 이벤트 클래스
- 계층 구조 형성
  - DOM 요소 클래스 유사
- 최상위
  - [`Event`](https://dom.spec.whatwg.org/#event) <sub>(클래스)</sub>

#### 생성자
```javascript
let event = new Event(type[, options]);
```

##### `type` <sub>(문자열)</sub>
- 이벤트명
  - 내장 이벤트 <sub>(`'click'` 등)</sub>
  - 커스텀 이벤트 <sub>(`'my-event'` 등)</sub>

##### `[options]` <sub>(객체)</sub>
- `bubbles` <sub>(`boolean`)</sub>
  - 이벤트 버블링 여부
  - `false` <sub>(기본값)</sub>
- `cancelable` <sub>(`boolean`)</sub>
  - 기본 동작 취소 가능 여부
  - `false` <sub>(기본값)</sub>

### `dispatchEvent(event)` <sub>(요소 메서드)</sub>

##### 요소 이벤트 실행 과정
1. 이벤트 <sub>(객체)</sub> 생성
2. 요소 `dispatchEvent(event)` 호출

##### `click` <sub>(이벤트)</sub> 생성 · 실행 <sub>(실제 버튼 클릭 X)</sub>
- 이벤트 핸들러 동작
```html
<button id="elem" onclick="alert('클릭!');">자동으로 클릭 되는 버튼</button>

<script>
  let event = new Event("click");
  elem.dispatchEvent(event);
</script>
```

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **`isTrusted` <sub>(이벤트 객체 프로퍼티)</sub>**

##### 사용자 행동 이벤트 유발 여부 <sub>(`boolean`)</sub>
- `true`
  - 사용자 행동 통해 이벤트 생성
- `false`
  - 스크립트 통해 이벤트 생성

<br />

### 커스텀 이벤트 버블링

##### 커스텀 이벤트 생성
- 이벤트명
  - `'hello'`
- 버블링 활성화
  - `{ bubbles: true }`
- 이벤트 처리
  - `document` <sub>(객체)</sub>
```html
<h1 id="elem">Hello from the script!</h1>

<script>
  /* ① document (객체) 핸들러 설정
   addEventListener (메서드)
   - 커스텀 이벤트 핸들러 설정 시 사용
   on<event> (HTML 속성 · DOM 프로퍼티)
   - 내장 이벤트 전용
   - 커스텀 이벤트 미동작
     - ex) document.onhello
   */
  document.addEventListener("hello", function(event) {
    alert("Hello from " + event.target.tagName);
  });

  /* ② hello (커스텀 이벤트) 생성
   elem (요소)
   - 이벤트 디스패치 (발생)
   { bubbles: true } 명시적 설정 필요
   - 미설정 시 버블링 X
   */
  let event = new Event("hello", { bubbles: true });
  elem.dispatchEvent(event);

  // document (객체) 핸들러 동작
  // - "Hello from H1" 얼럿창 출력
</script>
```

##### 내장 · 커스텀 이벤트
- 버블링 메커니즘 동일
  - 동일 이벤트 단계 <sub>(3가지)</sub> 有

### 다양한 이벤트

#### [UI 이벤트](https://www.w3.org/TR/uievents/) 섹션 <sub>(명세서)</sub>

##### 다양한 UI 이벤트 클래스 명시
- `UIEvent`
- `FocusEvent`
- `MouseEvent`
- `WheelEvent`
- `KeyboardEvent`
- 기타 등등

##### 생성 시 관련 내장 클래스 사용 필수 <sub>(`Event` 클래스 X)</sub>
- ex\) `new MouseEvent("click")`
  - 마우스 클릭 이벤트
- `new Event(…)`
  - 전용 표준 프로퍼티 無

##### `new MouseEvent("click")`
- 전용 표준 프로퍼티 설정
  - `clientX`
  - `clientY`
```javascript
let event = new MouseEvent("click", {
  bubbles: true,
  cancelable: true,
  clientX: 100,
  clientY: 100
});

alert(event.clientX); // 100
```

##### `new Event("click")`
- 전용 표준 프로퍼티 無
```javascript
let event = new Event("click", {
  bubbles: true,
  cancelable: true,
  clientX: 100, // 無
  clientY: 100  // 無
});

// 알 수 없는 프로퍼티
alert(event.clientX); // undefined

// 생성 후 직접 명시 가능
event.clientX = 100;
```

##### 브라우저 생성 UI 이벤트
- 정확한 이벤트 타입 준수 권장

##### UI 이벤트별 표준 프로퍼티 목록
- 명세서 확인
  - ex\) [`MouseEvent`](https://www.w3.org/TR/uievents/#mouseevent)

### 커스텀 이벤트

##### [`CustomEvent`](https://dom.spec.whatwg.org/#customevent) <sub>(클래스)</sub>
- `Event` <sub>(클래스)</sub> 유사
- 2번째 인수 <sub>(옵션 객체)</sub> 내 `detail` <sub>(프로퍼티)</sub>
  - 커스텀 이벤트 관련 정보 명시 · 전달
```html
<h1 id="elem">이보라님, 환영합니다!</h1>

<script>
  // 추가 정보
  // - 이벤트 함께 핸들러 전달
  elem.addEventListener("hello", function(event) {
    alert(event.detail.name);
  });

  elem.dispatchEvent(new CustomEvent("hello", {
    detail: { name: "보라" }
  }));
</script>
```

##### `detail` <sub>(객체 프로퍼티)</sub>
- 모든 값 저장 가능
- 타 이벤트 전용 표준 프로퍼티 충돌 방지
  - `Event` 객체 내 추가 프로퍼티
    - 충돌 가능성 有
- `new CustomEvent` <sub>(생성자)</sub>
  - 코드 자체 '커스텀 이벤트' 설명

### 기본 동작

##### 대다수 이벤트
- 기본 동작 함께 실행
  - 링크 클릭
    - 해당 url 이동
  - 폼 전송 버튼 클릭
    - 폼 서버 전송
  - 기타 등등

##### 커스텀 이벤트
- 기본 동작 無
- 기본 동작 설정 가능
  - 이벤트 디스패치 코드 연계

##### `preventDefault()` <sub>(이벤트 객체 메서드)</sub>
- 기본 동작 취소

##### `dispatchEvent(event)` <sub>(요소 메서드)</sub>
- 기본 동작 취소 시 `false` 반환
- 이벤트 디스패치 코드
  - 반환 값 <sub>(`false`)</sub> 통해 취소 인지
- 예시엔 id가 rabbit인 요소, "hide" 이벤트를 실행시키는 함수 hide()가 있습니다.
- hide()는 다른 코드들이 이벤트 실행 여부를 알 수 있게 해줍니다.
- rabbit.addEventListener('hide',...)를 사용하면 어떤 핸들러에서도 "hide"를 리스닝 할 수 있습니다.
-  그리고 필요하다면 event.preventDefault()를 사용해 "hide" 이벤트의 기본 동작을 취소할 수 있습니다.
- 이렇게 기본동작이 취소되면 토끼가 화면에서 사라지지 않습니다.

#### 토끼 숨기기

##### 구성
- `<… id="rabbit">` <sub>(요소)</sub>
- `hide()` <sub>(함수)</sub>
  - `hide` <sub>(이벤트)</sub> 실행
  - 타 코드들에 이벤트 실행 여부 알림

##### `addEventListener('hide', …)`
- `hide` <sub>(이벤트)</sub> 처리 가능

##### `preventDefault()` <sub>(이벤트 객체 메서드)</sub>
- `hide` <sub>(이벤트)</sub> 기본 동작 <sub>(토끼 숨기기)</sub> 취소
  - 화면 내 토끼 미제거
```html
<pre id="rabbit">
  |\   /|
   \|_|/
   /. .\
  =\_Y_/=
   {>o<}
</pre>
<button onclick="hide()">hide()를 호출해 토끼 숨기기</button>

<script>
  function hide() {
    let event = new CustomEvent("hide", {

      // 기본 동작 취소 기능 활성화
      // - 미설정 시 preventDefault() 미동작
      cancelable: true
    });

    // 기본 동작 취소
    if (!rabbit.dispatchEvent(event)) {
      alert('기본 동작이 핸들러에 의해 취소되었습니다.');

    // 기본 동작
    } else {
      rabbit.hidden = true;
    }
  }

  rabbit.addEventListener('hide', function(event) {
    if (confirm("preventDefault를 호출하시겠습니까?")) {
      event.preventDefault();
    }
  });
</script>
```

![event-preventDefault](../../images/02/02/05/event-preventDefault.png)

### 이벤트 내 이벤트

##### 이벤트 처리
- 보통 큐 내 실행
  - 선입선출 순서

##### ex\) `onclick` <sub>(이벤트)</sub> 처리 중
1. 마우스 움직여 새 이벤트 발생 시
2. `mousemove` <sub>(핸들러)</sub>
    - `onclick` <sub>(이벤트)</sub> 처리 종료 후 호출

##### 이벤트 내 이벤트 <sub>(이벤트 내 `dispatchEvent` 등)</sub>
- 즉시 처리
- 새 이벤트 핸들러 호출 후
  - 현재 이벤트 핸들링 재개

##### `menu-open` <sub>(이벤트)</sub>
- `onclick` <sub>(이벤트)</sub> 처리 도중 트리거
  - `onclick` 핸들러 처리 대기 X
  - 바로 처리
```html
<button id="menu">메뉴(클릭해주세요)</button>

<script>
  menu.onclick = function() {
    alert(1);

    // 이벤트 내 디스패치 (중첩 이벤트)
    // - 외부 코드 (onclick) 처리 다시 시작 전 종료
    menu.dispatchEvent(new CustomEvent("menu-open", {
      bubbles: true
    }));

    alert(2);
  };

  // '1' · '2' 사이 트리거
  // 얼럿창 출력 순서
  // - '1' → '중첩 이벤트' → '2'
  document.addEventListener('menu-open', () => alert('중첩 이벤트'));
</script>
```

![event-in-event](../../images/02/02/05/event-in-event.png)

#### 중첩 이벤트 처리 순서

##### 동기적 처리
- 이벤트 내 `dispatchEvent`
- 이벤트 핸들러 내 타 이벤트 트리거 메서드 호출
- 기타 등등

##### 순서 변경
- 중첩 이벤트 발생 코드 위치 변경
  - ex\) `onclick` 핸들러 끝부분
- 지연시간 0 `setTimeout` <sub>(메서드)</sub>
  - 중첩 이벤트 감싸기
```html
<button id="menu">Menu (click me)</button>

<script>
  menu.onclick = function() {
    alert(1);

    /* 지연시간 0 setTimeout (메서드)
     현재 코드 종료 후 실행
     - mouse.onclick (핸들러) 종료 후
     이벤트 핸들러들
     - 독립적 실행
     */
    setTimeout(() => menu.dispatchEvent(new CustomEvent("menu-open", {
      bubbles: true
    })));

    alert(2);
  };

  // '1' · '2' 이후 트리거
  // 얼럿창 출력 순서
  // - '1' → '2' → '중첩 이벤트'
  document.addEventListener('menu-open', () => alert('중첩 이벤트'));
</script>
```

<br />

요약
====

#### `Event(name, options)` <sub>(클래스 생성자)</sub>
- 범용적 사용

##### `name` <sub>(문자열)</sub>
- 이벤트명

##### `options` <sub>(객체)</sub>
- `[bubbles]` <sub>(`boolean`)</sub>
  - 이벤트 버블링 여부
- `[cancelable]` <sub>(`boolean`)</sub>
  - 기본 동작 취소 가능 여부
  - `preventDefault()`

##### 네이티브 이벤트 클래스 생성자
- 전용 표준 프로퍼티 有
  - ex\) `clientX` <sub>(마우스 이벤트)</sub>

#### 커스텀 이벤트

##### `CustomEvent` <sub>(클래스 생성자)</sub>
- `detail` <sub>(객체 프로퍼티)</sub>
  - 이벤트 관련 정보 저장
  - 타 핸들러
    - 커스텀 이벤트 정보 확인

#### 브라우저 내장 이벤트명 가능
- 가능하면 지양
- 설계 관점 좋지 않음

##### 예외적 사용 경우
- 서드파티 라이브러리
  - 정상 동작 목적
  - 유일한 상호작용 방법
- 테스팅 자동화
  - 내장 이벤트 실행
    - 사용자 동작 X
    - 코드 조작
