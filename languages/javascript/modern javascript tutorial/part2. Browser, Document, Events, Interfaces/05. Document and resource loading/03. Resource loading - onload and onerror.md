`on[loadÂ·error]` <sub>(ë¦¬ì†ŒìŠ¤ ë¡œë”©)</sub>
=================================

##### ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ ë¡œë”© ì¶”ì  ê°€ëŠ¥
- ìŠ¤í¬ë¦½íŠ¸
- `iframe`
- ì´ë¯¸ì§€
- ê¸°íƒ€ ë“±ë“±

##### ê´€ë ¨ ì´ë²¤íŠ¸
- `onload`
  - ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì„±ê³µ
- `onerror`
  - ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì‹¤íŒ¨

### ìŠ¤í¬ë¦½íŠ¸ ë¡œë”©

##### ì„œë“œíŒŒí‹° ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í›„ í•¨ìˆ˜ í˜¸ì¶œ
- ìŠ¤í¬ë¦½íŠ¸
  - ë™ì  ë¡œë“œ
- í•¨ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ í›„ í˜¸ì¶œ
```javascript
let script = document.createElement('script');
script.src = "my.js";

document.head.append(script);
```

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **ì£¼ì˜**

##### JS ëª¨ë“ˆ
- ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¯¸ì§€ì› ê°€ëŠ¥ì„± æœ‰

<br />

#### `script.onload`

##### `load` <sub>(ì´ë²¤íŠ¸)</sub>
- ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ Â· ì‹¤í–‰ í›„ ë°œìƒ
```javascript
let script = document.createElement('script');
script.src = "https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.3.0/lodash.js"
document.head.append(script);

// í•¸ë“¤ëŸ¬ ì„¤ì •
// - ë¡œë”© ìŠ¤í¬ë¦½íŠ¸ ë‚´ ë³€ìˆ˜ Â· í•¨ìˆ˜ ì‚¬ìš©
script.onload = function() {

  // lodash (ë¼ì´ë¸ŒëŸ¬ë¦¬) ìŠ¤í¬ë¦½íŠ¸
  // '_' (ë³€ìˆ˜) ìƒì„±
  alert( _.VERSION ); // ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „
};
```

#### `script.onerror`

##### `error` <sub>(ì´ë²¤íŠ¸)</sub>
- ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì‹¤íŒ¨ ì‹œ ë°œìƒ
  - `404` ì—ëŸ¬ <sub>(ìŠ¤í¬ë¦½íŠ¸ ë¶€ì¬)</sub>
  - ì„œë²„ ë¬¸ì œ ë°œìƒ <sub>(ì‚¬ìš© ë¶ˆê°€ëŠ¥)</sub>

##### `404` ì—ëŸ¬ <sub>(ìŠ¤í¬ë¦½íŠ¸ ë¶€ì¬)</sub>
- ë¯¸ì¡´ì¬ ìŠ¤í¬ë¦½íŠ¸ ìš”ì²­
```javascript
let script = document.createElement('script');

// ë¯¸ì¡´ì¬ ìŠ¤í¬ë¦½íŠ¸
script.src = "https://example.com/404.js";
document.head.append(script);

script.onerror = function() {

  // Error loading https://example.com/404.js
  alert("Error loading " + this.src);
};
```

##### ì°¸ê³ 
- HTTP ì—ëŸ¬ ìƒì„¸ ì •ë³´ X
  - `400`
  - `500`
  - ê¸°íƒ€ ë“±ë“±
- ë¡œë”© ì‹¤íŒ¨ë§Œ í™•ì¸

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **ì¤‘ìš”**

##### `on[loadÂ·error]` <sub>(ì´ë²¤íŠ¸)</sub>
- ë¡œë”© ì™¸ ì¶”ì  X
  - ì²˜ë¦¬
  - ì‹¤í–‰
  - ê¸°íƒ€ ë“±ë“±
- ë¡œë”© ì™¸ ì¶”ì  í•„ìš” ì‹œ
  - `window.onerror` <sub>(ì „ì—­ í•¸ë“¤ëŸ¬)</sub> ì‚¬ìš©

<br />

### ê¸°íƒ€ ë¦¬ì†ŒìŠ¤

##### `load` Â· `error` <sub>(ì´ë²¤íŠ¸)</sub>
- ì™¸ë¶€ ì†ŒìŠ¤ <sub>(`src` ì†ì„±)</sub> ìš”ì†Œ ëŒ€ìƒ ë°œìƒ
```javascript
let img = document.createElement('img');

// src (ì†ì„±)
// - ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ ì„¤ì •
img.src = "https://js.cx/clipart/train.gif";

img.onload = function() {
  alert(`Image loaded, size ${img.width}x${img.height}`);
};

img.onerror = function() {
  alert("Error occurred while loading image");
};
```

#### íŠ¹ì§• <sub>(ì—­ì‚¬ì  ì´ìœ )</sub>

##### ëŒ€ë‹¤ìˆ˜ ë¦¬ì†ŒìŠ¤ <sub>(ìš”ì†Œ)</sub>
- ë¬¸ì„œ ë‚´ ì¶”ê°€ ì‹œ ë¡œë“œ ì‹œì‘

##### `<img>` <sub>(ìš”ì†Œ)</sub>
- `src` <sub>(ì†ì„±)</sub> ì„¤ì • ì‹œ ë¡œë“œ ì‹œì‘

##### `<iframe>` <sub>(ìš”ì†Œ)</sub> `load Â· error` <sub>(ì´ë²¤íŠ¸)</sub>
- ë¡œë“œ ì™„ë£Œ ì‹œ ë°œìƒ

### Cross-origin ì •ì±…

##### ê·œì¹™
- í•œ ì‚¬ì´íŠ¸ ë‚´ ìŠ¤í¬ë¦½íŠ¸
  - íƒ€ ì‚¬ì´íŠ¸ ì½˜í…ì¸  ì ‘ê·¼ X
- í•œ ì˜¤ë¦¬ì§„ <sub>(ë„ë©”ì¸ Â· í¬íŠ¸ Â· í”„ë¡œí† ì½œ)</sub>
  - íƒ€ ì˜¤ë¦¬ì§„ ì½˜í…ì¸  ì ‘ê·¼ X
- ex\) `https://facebook.com` <sub>(ë‚´ ìŠ¤í¬ë¦½íŠ¸)</sub>
  - `https://gmail.com` ë‚´ ë©”ì¼ ì½ê¸° X
- ì„œë¸Œë„ë©”ì¸ Â· íƒ€ í¬íŠ¸
  - ê°ê° íƒ€ ì˜¤ë¦¬ì§„
    - ì„œë¡œì˜ ì½˜í…ì¸  ì ‘ê·¼ X
- í•œ ì˜¤ë¦¬ì§„
  - íƒ€ ë„ë©”ì¸ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ X
- íƒ€ ë„ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ <sub>(ì—ëŸ¬ ë°œìƒ)</sub> ì‚¬ìš© ì‹œ
  - ì—ëŸ¬ ìƒì„¸ ì •ë³´ ì ‘ê·¼ X

##### `error.js` <sub>(ìŠ¤í¬ë¦½íŠ¸)</sub>
- ì˜ëª»ëœ í•¨ìˆ˜ í˜¸ì¶œ êµ¬í˜„
```javascript
/* ğŸ“ error.js */
noSuchFunction();
```
- ë™ì¼ ì‚¬ì´íŠ¸ ë‚´ í•¨ìˆ˜ <sub>(`error.js`)</sub> í˜¸ì¶œ
```html
<script>
window.onerror = function(message, url, line, col, errorObj) {
  alert(`${message}\n${url}, ${line}:${col}`);
};
</script>
<script src="/article/onload-onerror/crossorigin/error.js"></script>
```
- ì—ëŸ¬ ìƒì„¸ ì •ë³´
```
Uncaught ReferenceError: noSuchFunction is not defined
https://javascript.info/article/onload-onerror/crossorigin/error.js, 1:1
```
- íƒ€ ë„ë©”ì¸ ë‚´ í•¨ìˆ˜ <sub>(`error.js`)</sub> í˜¸ì¶œ
```html
<script>
window.onerror = function(message, url, line, col, errorObj) {
  alert(`${message}\n${url}, ${line}:${col}`);
};
</script>
<script src="https://cors.javascript.info/article/onload-onerror/crossorigin/error.js"></script>
```
- ì—ëŸ¬ ìƒì„¸ ì •ë³´ X <sub>(ë¸Œë¼ìš°ì €ë³„ ìƒì´)</sub>
```
Script error.
, 0:0
```

##### ìˆ˜ë§ì€ ì„œë¹„ìŠ¤
- ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬ <sub>(`window.onerror`)</sub>
- ì—ëŸ¬ ì €ì¥
- ì¸í„°í˜ì´ìŠ¤ ì œê³µ
  - ì—ëŸ¬ ì ‘ê·¼ Â· ë¶„ì„
- ì‹¤ì œ ì‚¬ìš©ì ìœ ë°œ ì—ëŸ¬
  - ë¶„ì„ Â· ì²˜ë¦¬ Â· ëŒ€ì‘
- íƒ€ ì˜¤ë¦¬ì§„ ìŠ¤í¬ë¦½íŠ¸
  - ì—ëŸ¬ ë‚´ ìƒì œ ì •ë³´ X
    - ì—ëŸ¬ ë¶„ì„ Â· ì²˜ë¦¬ X

##### ê¸°íƒ€ ë¦¬ì†ŒìŠ¤
- ë™ì¼ ê·œì¹™ ì ìš©

##### cross-origin ì ‘ê·¼ í—ˆìš©
- `<script>` <sub>(íƒœê·¸)</sub>
  - `crossorigin` <sub>(ì†ì„±)</sub> ì„¤ì •
- ì›ê²© ì„œë²„
  - íŠ¹ìˆ˜ í—¤ë” ì œê³µ

#### ê³¼ì •

##### 1. `crossorigin` <sub>(ì†ì„±)</sub> ë¶€ì¬
- ì ‘ê·¼ ê±°ì ˆ

##### 2. `crossorigin="anonymous"`
- ì›ê²© ì„œë²„ í—¤ë” ì‘ë‹µ ì‹œ
  - ì ‘ê·¼ í—ˆìš©
```javascript
Access-Control-Allow-Origin: [*Â·ì˜¤ë¦¬ì§„]
```
- ë¸Œë¼ìš°ì € â†’ ì›ê²© ì„œë²„
  - í—ˆê°€ ì •ë³´ Â· ì¿ í‚¤ ë¯¸ì „ì†¡

##### 3. `crossorigin="use-credentials"`
- ì›ê²© ì„œë²„ í—¤ë” <sub>(2ê°œ)</sub> ì‘ë‹µ ì‹œ
  - ì ‘ê·¼ í—ˆìš©
```javascript
Access-Control-Allow-Origin: ì˜¤ë¦¬ì§„
Access-Control-Allow-Credentials: true
```
- ë¸Œë¼ìš°ì € â†’ ì›ê²© ì„œë²„
  - í—ˆê°€ ì •ë³´ Â· ì¿ í‚¤ ì „ì†¡

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **ì£¼ì˜**

##### CORS ì±•í„° ì°¸ê³ 
- `fetch` <sub>(ë©”ì„œë“œ)</sub> ì„¤ëª…
  - ë„¤íŠ¸ì›Œí¬ ìš”ì²­ <sub>(ë™ì¼ ì •ì±…)</sub>

##### ì¿ í‚¤
- ì¿ í‚¤ ì±•í„° ì°¸ê³ 

<br />

##### `crossorigin` <sub>(ì†ì„±)</sub> ì„¤ì •
- `"anonymous"`
  - ì¿ í‚¤ ë¯¸ì „ì†¡
  - ì‘ë‹µ í—¤ë” 1ê°œ í•„ìš”
- `"use-credentials"`
  - ì¿ í‚¤ ì „ì†¡
  - ì‘ë‹µ í—¤ë” 2ê°œ í•„ìš”

##### `crossorigin="anonymous"` <sub>(ì†ì„±)</sub> ì„¤ì •
- ì›ê²© ì„œë²„ í•„ìš” í—¤ë” í•¨ê»˜ ì‘ë‹µ ì‹œ
  - ì—ëŸ¬ ìƒì„¸ ì •ë³´ ì ‘ê·¼ ê°€ëŠ¥

```html
<script>
window.onerror = function(message, url, line, col, errorObj) {
  alert(`${message}\n${url}, ${line}:${col}`);
};
</script>
<script crossorigin="anonymous" src="https://cors.javascript.info/article/onload-onerror/crossorigin/error.js"></script>
```

<br />

## ìš”ì•½
Images `<img>`, external styles, scripts and other resources provide `load` and `error` events to track their loading:
- `load` triggers on a successful load,
- `error` triggers on a failed load.

The only exception is `<iframe>`: for historical reasons it always triggers `load`, for any load completion, even if the page is not found.

The `readystatechange` event also works for resources, but is rarely used, because `load`/`error` events are simpler.

<br />

## <img src="../../images/commons/icons/circle-check-solid.svg" /> ê³¼ì œ

### Load images with a callback
Normally, images are loaded when they are created. So when we add `<img>` to the page, the user does not see the picture immediately. The browser needs to load it first.

To show an image immediately, we can create it "in advance", like this:
```javascript
let img = document.createElement('img');
img.src = 'my.jpg';
```

The browser starts loading the image and remembers it in the cache. Later, when the same image appears in the document (no matter how), it shows up immediately.

**Create a function `preloadImages(sources, callback)` that loads all images from the array `sources` and, when ready, runs `callback`.**

For instance, this will show an `alert` after the images are loaded:
```javascript
function loaded() {
  alert("Images loaded")
}

preloadImages(["1.jpg", "2.jpg", "3.jpg"], loaded);
```

In case of an error, the function should still assume the picture "loaded".

In other words, the `callback` is executed when all images are either loaded or errored out.

The function is useful, for instance, when we plan to show a gallery with many scrollable images, and want to be sure that all images are loaded.

In the source document you can find links to test images, and also the code to check whether they are loaded or not. It should output `300`.

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

The algorithm:
1. Make `img` for every source.
2. Add `onload`/`onerror` for every image.
3. Increase the counter when either `onload` or `onerror` triggers.
4. When the counter value equals to the sources count â€“ we're done: `callback()`.

[ìƒŒë“œë°•ìŠ¤ë¥¼ ì—´ì–´ ì •ë‹µì„ í™•ì¸í•´ë³´ì„¸ìš”.](https://plnkr.co/edit/M0qVEmqZnmYnFVIT?p=preview)
