`key[down·up]` <sub>(키보드)</sub>
==========================

##### 다양한 입력 방법 有 <sub>(모던 디바이스)</sub>
- 음성 인식 <sub>(주로 모바일 기기)</sub>
- 복사 · 붙여넣기
- 기타 등등

##### `<input>` <sub>(필드)</sub> 내 입력 추적
- 키보드 이벤트 <sub>(단일)</sub>
  - 불충분
- `input` 이벤트
  - `<input>` <sub>(필드)</sub> 변화 추적
    - 입력 종류 무관
  - 대다수 경우 유용

##### 키보드 이벤트
- 키보드 동작 처리 <sub>(가상 키보드 포함)</sub>
  - 화살표키 누르기 · 떼기
  - 핫키 같이 누르기
  - 기타 등등

### 테스트

![teststand](../../images/02/03/05/teststand.png)

```html
<!-- index.html -->
<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <form id="form" onsubmit="return false">

    Prevent default for:
    <label>
      <input type="checkbox" name="keydownStop" value="1" /> keydown
    </label>&nbsp;&nbsp;&nbsp;
    <label>
      <input type="checkbox" name="keyupStop" value="1" /> keyup
    </label>

    <p>
      Ignore:
      <label>
        <input type="checkbox" name="keydownIgnore" value="1" /> keydown
      </label>&nbsp;&nbsp;&nbsp;
      <label>
        <input type="checkbox" name="keyupIgnore" value="1" /> keyup
      </label>
    </p>

    <p>Focus on the input field and press a key.</p>

    <input type="text" placeholder="Press keys here" id="kinput" />

    <textarea id="area"></textarea>
    <input type="button" value="Clear" onclick="area.value = ''" />
  </form>
  <script src="script.js"></script>

</body>
</html>
```
```javascript
// script.js
kinput.onkeydown = kinput.onkeyup = kinput.onkeypress = handle;

let lastTime = Date.now();

function handle(e) {
  if (form.elements[e.type + 'Ignore'].checked) return;

  let text = e.type +
    ' key=' + e.key +
    ' code=' + e.code +
    (e.shiftKey ? ' shiftKey' : '') +
    (e.ctrlKey ? ' ctrlKey' : '') +
    (e.altKey ? ' altKey' : '') +
    (e.metaKey ? ' metaKey' : '') +
    (e.repeat ? ' (repeat)' : '') +
    "\n";

  if (area.value && Date.now() - lastTime > 250) {
    area.value += new Array(81).join('-') + '\n';
  }
  lastTime = Date.now();

  area.value += text;

  if (form.elements[e.type + 'Stop'].checked) {
    e.preventDefault();
  }
}
```
```css
/* style.css */
#kinput { font-size: 150%; box-sizing: border-box; width: 95%; }
#area { width: 95%; box-sizing: border-box; height: 250px; border: 1px solid black; display: block; }
form label { display: inline; white-space: nowrap; }
```

### `Key[down·up]` <sub>(이벤트)</sub>
- 키 누를 때 · 뗄 때 발생

#### `event.[key·code]` <sub>(프로퍼티)</sub>
- 눌린 키 해당 문자 · 문자 코드
- `key`
  - 상이 가능
- `code`
  - 항상 동일

|키|`key`|`code`|
|---|---|---|
|Z|`"z"` <sub>(소문자)</sub>|`"KeyZ"`|
|Shift + Z|`"Z"` <sub>(대문자)</sub>|`"KeyZ"`|

##### 언어 변경 시 <sub>(영어 → 일어 등)</sub>
- ex\) Z 키
  - `key`
    - 완전 다른 문자
  - `code`
    - `"KeyZ"` <sub>(동일)</sub>

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **키 코드**

##### 표준 키 코드
- [UI Events code specification](https://www.w3.org/TR/uievents-code/)

##### `"Key<letter>"` <sub>(문자 키)</sub>
- `"Key[a-zA-Z]"`

##### `"Digit<number>"` <sub>(숫자 키)</sub>
- `"Digit[0-9]"`

##### `"<keyName>"` <sub>(특수 키)</sub>
- `"Enter"`
- `"Backspace"`
- `"Tab"`
- 기타 등등

##### 기타 키보드 레이아웃
- [alphanumeric section](https://www.w3.org/TR/uievents-code/#key-alphanumeric-section)

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **키 코드 : 대 · 소문자 구분**

##### 대문자 시작
- ex\) Z 키 코드

|`code`||
|---|---|
|`"KeyZ"`|O|
|`"keyZ"`|X|

##### - ex\) `event.code == "keyZ"` <sub>(소문자 시작)</sub>
- 정상적 비교 X

<br />

##### 특수 키
- 대개 `key` == `code`

|키|`key`|`code`|
|---|---|---|
|F1|`"F1"`|`"F1"`|
|Backspace|`"Backspace"`|`"Backspace"`|
|Shift|`"Shift"`|`"Shift[Right·Left]"`|

##### `key` vs `code`
- `key`
  - 의미
    - ex\) `"Shift"`
- `code`
  - 정확히 눌린 키
    - ex\) `"Shift[Right·Left]"`

##### `code` 장점
- 항상 동일
  - `keydown` 핸들러 내 사용
- `key`
  - 언어 체계 따라 상이
```javascript
document.addEventListener('keydown', function(event) {
  if (event.code == 'KeyZ' && (event.ctrlKey || event.metaKey)) {
    alert('Undo!')
  }
});
```

##### `code` 단점
- 키보드 레이아웃 상이 시
  - 동일 키 → 다른 문자

#### 미국 <sub>("QWERTY")</sub> vs 독일 <sub>("QWERTZ")</sub>

##### 미국 <sub>("QWERTY")</sub>
- Z 키 == `"KeyZ"`

![us-layout](../../images/02/03/05/us-layout.svg)

##### 독일 <sub>("QWERTZ")</sub>
- Y 키 == `"KeyZ"`

![german-layout](../../images/02/03/05/german-layout.svg)

##### `event.code == 'KeyZ'`
- 미국 <sub>("QWERTY")</sub>
  - Z 키
- 독일 <sub>("QWERTZ")</sub>
  - Y 키

##### [specification](https://www.w3.org/TR/uievents-code/#table-key-code-alphanumeric-writing-system)
- 키보드 레이아웃 문제 설명
  - 목록 수록
- 일부 키만 해당
  - `key[A·Q·Z]`
- 특수 키 미해당
  - Shift 키
  - 기타 등등

##### 키 문자 추적
- `key` 사용 권장
  - 레이아웃 종류 무관
- 항상 동일 <sub>(실제 키 위치 기반)</sub>
  - 핫키 정상 동작 <sub>(사용 언어 무관)</sub>

### 자동 반복

##### 충분히 긴 시간 동안 키 계속 누르면 발생
- `keydown` <sub>(이벤트)</sub>
  - 계속 발생
- `keyup` <sub>(이벤트)</sub>
  - 키 떼면 발생
- 일반적인 키 이벤트
  - `keydown` <sub>(이벤트)</sub>
    - 다수 발생
  - `keyup` <sub>(이벤트)</sub>
    - 한 번 발생
- `event.repeat` <sub>(프로퍼티)</sub>
  - `true`

### 기본 동작

##### 다양한 기본 동작 有
- 화면에 문자 출력
  - 가장 기본적인 동작
- 문자 삭제
  - Delete 키
- 페이지 스크롤
  -  PageDown 키
- "페이지 저장" 대화상자 열기
  - Ctrl + S 키
- 기타 등등

##### 기본 동작 막기
- 다양한 기본 동작 전부 비활성화
- OS 기반 특수 키 제외
  - ex\) Alt + F4 <sub>(Windows)</sub>
    - 현재 브라우저 창 닫기

##### `<input>` <sub>(필드)</sub> 허용 문자
- 숫자 키
- `'+'` · `'-'`
- `'('` · `')'`
```html
<script>
function checkPhoneKey(key) {
  return ('0' <= key && key <= '9')
    || key == '+'
    || key == '-';
    || key == '('
    || key == ')'
}
</script>
<input onkeydown="return checkPhoneKey(event.key)" placeholder="Phone, please" type="tel">
```

![default-option](../../images/02/03/05/default-option.png)

##### 일부 특수 키 허용 <sub>(부작용 수정 · 편의성↑)</sub>
- `'←'`
- `'→'`
- `'Backspace'`
- `'Delete'`
- Ctrl + V 키
- 기타 등등
```html
<script>
function checkPhoneKey(key) {
  return ('0' <= key && key <= '9')
    || key == '+'
    || key == '-'
    || key == '('
    || key == ')'
    || key == 'ArrowLeft'
    || key == 'ArrowRight'
    || key == 'Backspace';
    || key == 'Delete'
}
</script>
<input onkeydown="return checkPhoneKey(event.key)" placeholder="Phone, please" type="tel">
```
![default-option](../../images/02/03/05/default-option.png)

##### 보완 부분
- 마우스 우클릭 + "붙여넣기" 막기
- 기타 등등

##### 대안
- `input` <sub>(이벤트)</sub>
  - 필드 수정 시 발생
- 핸들러 내 다양한 동작 수행
  - 새 값 확인 · 강조 · 수정 등

### 레거시 코드

##### deprecated · 사용 X
- `keypress`
- `[key·char]Code`
- `which`

<br />

## 요약

##### 키보드 이벤트
- 키 누를 때 발생
  - 문자 키
  - 숫자 키
  - 특수 키
- 예외 키 <sub>(이벤트 X)</sub>
  - Fn 키 <sub>(주로 노트북)</sub>
    - 대개 저레벨 구현 <sub>(OS 단계 ↓)</sub>

Keyboard events:
- `keydown` – on pressing the key (auto-repeats if the key is pressed for long),
- `keyup` – on releasing the key.

Main keyboard event properties:
- `code` – the "key code" (`"KeyA"`, `"ArrowLeft"` and so on), specific to the physical location of the key on keyboard.
- `key` – the character (`"A"`, `"a"` and so on), for non-character keys, such as Esc, usually has the same value as `code`.

In the past, keyboard events were sometimes used to track user input in form fields. That's not reliable, because the input can come from various sources. We have `input` and `change` events to handle any input (covered later in the chapter 이벤트: change, input, cut, copy, paste). They trigger after any kind of input, including copy-pasting or speech recognition.

We should use keyboard events when we really want keyboard. For example, to react on hotkeys or special keys.

<br />

## <img src="../../images/commons/icons/circle-check-solid.svg" /> 과제

### Extended hotkeys
Create a function `runOnKeys(func, code1, code2, ... code_n)` that runs `func` on simultaneous pressing of keys with codes `code1`, `code2`, …, `code_n`.

For instance, the code below shows `alert` when `"Q"` and `"W"` are pressed together (in any language, with or without CapsLock)
```javascript
runOnKeys(
  () => alert("Hello!"),
  "KeyQ",
  "KeyW"
);
```

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

We should use two handlers: `document.onkeydown` and `document.onkeyup`.

Let's create a set `pressed = new Set()` to keep currently pressed keys.

The first handler adds to it, while the second one removes from it. Every time on `keydown` we check if we have enough keys pressed, and run the function if it is so.

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/BPG4XiITnq5D3FM5?p=preview)
