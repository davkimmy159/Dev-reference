스크롤링
=======

##### 페이지 · 요소 스크롤링 처리
- 추가 요소 표시 · 미표시
  - 문서 상 사용자 위치 기준
- 추가 정보 로드
  - 페이지 최하단 스크롤 도달 시

##### 현재 스크롤 표시
```javascript
window.addEventListener('scroll', function() {
  document.getElementById('showScroll').innerHTML = window.pageYOffset + 'px';
});
```

##### In action
- Current scroll = `scroll the window`

##### 스크롤 이벤트 적용 가능 요소
- `window`
- 스크롤 가능 요소

### 스크롤링 막기

#### `preventDefault()` <sub>(메서드)</sub>

##### `onscroll` 핸들러 내 호출 X
- 스크롤 실행 후
  - `onscroll` <sub>(이벤트)</sub> 발생
    - `preventDefault()` 호출

##### 스크롤 유발 이벤트 발생 시 호출
- `keydown` <sub>(이벤트)</sub>
  - page\[Up·Down\] 키
  - 기타 등등

### 스크롤링 동작시키기
- 다양한 방법 有
  - `overflow` <sub>(CSS 프로퍼티)</sub> 권장

<br />

## <img src="../../images/commons/icons/circle-check-solid.svg" /> 과제

### 끝업는 페이지

##### 끝없는 페이지 작성
- 최하단 스크롤 도달 시
  - 현재 날짜 자동 추가
  - 스크롤 가능 공간 계속 생성

![assignment-endless-page](../../images/02/03/06/assignment-endless-page.png)

#### 스크롤 중요 특징 <sub>(2가지)</sub>

##### 1. 탄력성 <sub>(일부 브라우저 · 디바이스)</sub>
- 문서 처음 · 끝부분 스크롤 도달 시
  1. 빈 공간 살짝 보임
  2. 다시 가려짐 <sub>(원위치 이동)</sub>

##### 2. 부정확성
- 문서 끝 스크롤 도달 시
  - 실제 문서 끝 위치 도달 X
  - 0 ~ 50px 거리 有 가능

##### 문서 끝 스크롤 도달 의미
- 문서 끝에서 100px 내 위치 도달

##### 실생활
- 문서 끝 도달 시 문구 표시
  - "더 보기"
  - 기타 등등

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

##### 창 기준 좌표
- 문서 위치
  - `<html>` <sub>(태그)</sub> 안
```javascript
let html = document.documentElement;
```

##### 창 기준 문서 좌표
```javascript
let coordinate = document.documentElement.getBoundingClientRect();
```

#### 높이 `2000px` 문서 좌표 <sub>(창 기준)</sub>

##### 창 최상단 스크롤 위치
```javascript
document.documentElement.getBoundingClientRect().top == 0;

// 문서 높이 > 창 높이
document.documentElement.getBoundingClientRect().bottom == 2000;
```

##### `500px` 스크롤 내리기
```javascript
// 500px 멀어짐 (창 윗부분)
document.documentElement.getBoundingClientRect().top == -500

// 500px 가까워짐 (창 최상단 기준)
document.documentElement.getBoundingClientRect().bottom == 1500
```

##### 최하단 스크롤 도달
```javascript
// 1400px 멀어짐 (창 윗부분)
document.documentElement.getBoundingClientRect().top == -1400;

// 1400px 가까워짐 (창 최상단 기준)
// 더 이상 가까워질 수 없음
// - 최솟값 == 창 높이
document.documentElement.getBoundingClientRect().bottom == 600;
document.documentElement.clientHeight == 600; // 창 높이
```

##### 문서 끝 스크롤 도달 감지 <sub>(0 ~ 100px 이내)</sub>
- `bottom` <sub>(좌표 프로퍼티)</sub> 값 범위
  - 600 ~ 700px <sub>(창 높이 == 600px)</sub>
```javascript
function populate() {
  while(true) {

    // 창 기준 문서 바닥 좌표
    let dBbottom = document.documentElement.getBoundingClientRect().bottom;

    // 창 높이
    let wHeight = document.documentElement.clientHeight;

    // 문서 최하단 100px 이내 스크롤 미도달 시 스킵
    if (dBottom > wHeight + 100) break;

    // 현재 날짜 추가
    document.body.insertAdjacentHTML("beforeend", `<p>Date: ${new Date()}</p>`);
  }
}
```

[정답](https://plnkr.co/edit/38yuQHwUsUXCcsDv?p=preview)

<hr />

### 위 · 아래 버튼

##### ▲ <sub>(위로 이동)</sub> 버튼 작성
- 페이지 스크롤 편의 도모

##### 작동 방식
- 최하단 스크롤 미도달 시
  - 미표시
- 최하단 스크롤 도달 시
  - 창 좌상단 표시
  - 스크롤 올리면 다시 미표시
- 클릭 시
  - 스크롤 최상단 이동

![assignment-up-down-button](../../images/02/03/06/assignment-up-down-button.png)

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/ILfuOH6te6alT8vQ?p=preview)

<hr />

### Load visible images
Let's say we have a slow-speed client and want to save their mobile traffic.

For that purpose we decide not to show images immediately, but rather replace them with placeholders, like this:

```html
<img src="placeholder.svg" width="128" height="128" data-src="real.jpg">
```

So, initially all images are `placeholder.svg`. When the page scrolls to the position where the user can see the image – we change `src` to the one in `data-src`, and so the image loads.

Here's an example in `iframe`:

![assignment-load-visiable-images-1](../../images/02/03/06/assignment-load-visiable-images-1.png)

![assignment-load-visiable-images-2](../../images/02/03/06/assignment-load-visiable-images-2.png)

Scroll it to see images load "on-demand".

Requirements:
- When the page loads, those images that are on-screen should load immediately, prior to any scrolling.
- Some images may be regular, without `data-src`. The code should not touch them.
- Once an image is loaded, it should not reload any more when scrolled in/out.

P.S. If you can, make a more advanced solution that would "preload" images that are one page below/after the current position.

P.P.S. Only vertical scroll is to be handled, no horizontal scrolling.

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

The `onscroll` handler should check which images are visible and show them.

We also want to run it when the page loads, to detect immediately visible images and load them.

The code should execute when the document is loaded, so that it has access to its content.

Or put it at the `<body>` bottom:
```javascript
// ...the page content is above...

function isVisible(elem) {

  let coords = elem.getBoundingClientRect();

  let windowHeight = document.documentElement.clientHeight;

  // top elem edge is visible?
  let topVisible = coords.top > 0 && coords.top < windowHeight;

  // bottom elem edge is visible?
  let bottomVisible = coords.bottom < windowHeight && coords.bottom > 0;

  return topVisible || bottomVisible;
}
```

The `showVisible()` function uses the visibility check, implemented by `isVisible()`, to load visible images:
```javascript
function showVisible() {
  for (let img of document.querySelectorAll('img')) {
    let realSrc = img.dataset.src;
    if (!realSrc) continue;

    if (isVisible(img)) {
      img.src = realSrc;
      img.dataset.src = '';
    }
  }
}

showVisible();
window.onscroll = showVisible;
```

P.S. The solution also has a variant of `isVisible` that "preloads" images that are within 1 page above/below the current document scroll.

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/a3ixa5sPNqQeNulM?p=preview)
