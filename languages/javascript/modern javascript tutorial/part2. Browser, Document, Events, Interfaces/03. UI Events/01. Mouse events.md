마우스 이벤트
============

##### 다른 장치에서도 발생
- 핸드폰
- 태블릿
- 기타 등등

### 마우스 이벤트 종류 <sub>(일부)</sub>

##### `mouse[down·up]`
- 요소 위 마우스 좌측 버튼
  - 누르기
  - 누르고 있다가 떼기

##### `mouse[over·out]`
- 마우스 커서
  - 요소 바깥 → 안 이동
  - 요소 위 → 바깥 이동

##### `mousemove`
- 마우스 이동

##### `click`
- 마우스 좌측 버튼
  - 요소 위 `mouse[down·up]` <sub>(이벤트)</sub>
    - 연달아 발생

##### `dblclick`
- 마우스 좌측 버튼
  - 요소 위 빠르게 클릭
- 요즘 드물게 사용

##### `contextmenu`
- 마우스 우측 버튼 누르기
- 특별 단축키
  - 동일 기능 실행
  - 이벤트 동일 X

### 마우스 이벤트 순서

##### 동작 하나 → 다수 이벤트 가능
- 실행 순서
  - 내부 규칙
- ex\) 마우스 좌측 버튼 클릭
  1. `mousedown`
  2. `mouseup`
  3. `click`

##### 버튼 클릭 · 더블클릭
- 아래 창
  - 모든 마우스 이벤트 기록

![mouse-event-order](../../images/02/03/01/mouse-event-order.png)

### 마우스 버튼

#### `button` <sub>(프로퍼티)</sub>
- 클릭 연관 이벤트 프로퍼티
- 이벤트 발생 버튼 정보

##### `click` · `contextmenu` <sub>(이벤트)</sub>
- 프로퍼티 드물게 사용
- 이벤트 발생 버튼 명확
  - 좌 <sub>(`click`)</sub>
  - 우 <sub>(`contextMenu`)</sub>

##### `mouse[down·up]` <sub>(이벤트)</sub>
- 프로퍼티 사용 필요
  - 모든 마우스 버튼 발생 가능

##### `button` <sub>(프로퍼티)</sub> 주요 값

|값|버튼|
|---|---|
|`0`|좌 <sub>(주)</sub>|
|`1`|중 <sub>(보조)</sub>|
|`2`|우 <sub>(2번째 주)</sub>|
|`3`|X1 <sub>(뒤로 가기)</sub>|
|`4`|X2 <sub>(앞으로 가기)</sub>|

##### 대다수 마우스
- 좌 · 우 버튼만 존재
  - `0` · `2`

##### 터치 지원 기기
- 기기 터치 시 유사 이벤트 생성

##### [`buttons` <sub>(프로퍼티)</sub>](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/buttons)
- 다수 버튼 한꺼번에 눌렀을 때
  - 해당 버튼들 정보 <sub>(정수)</sub> 저장
- 드물게 사용

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **역사의 뒤안길로 사라진 `event.which`**

##### `event.which`
- 클릭한 버튼 정보 저장
- 구식 코드 내 발견
- 비표준
- 더 이상 지원 X
  - 사용 X

|값|버튼|
|---|:---:|
|`1`|좌|
|`2`|중|
|`3`|우|

<br />

### `shift` · `alt` · `ctrl` · `meta` <sub>(프로퍼티)</sub>

##### 보조키 정보 프로퍼티
- 마우스 이벤트 발생 시 함께 누른 키 정보 저장

##### 보조키 별 지원 프로퍼티 <sub>(`boolean`)</sub>
- `shiftKey`
  - Shift 키
- `altKey`
  - Alt 키
  - Opt 키 <sub>(MacOS)</sub>
- `ctrlKey`
  - Ctrl 키
- `metaKey`
  - Cmd 키 <sub>(MacOS)</sub>

##### `onclick` 핸들러 동작 조건 설정
- 마우스 좌측 버튼 · Alt · Shift 키
  - 동시 누르기
```html
<button id="button">Alt, Shift 키를 누른 상태에서 클릭해주세요!</button>

<script>
  button.onclick = function(event) {
    if (event.altKey && event.shiftKey) {
      alert('야호!');
    }
  };
</script>
```

![shift-alt-ctrl-meta-property](../../images/02/03/01/shift-alt-ctrl-meta-property.png)

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **MacOS : Ctrl 대신 Cmd 사용**

##### Windows · Linux
- Alt · Shift · Ctrl 키 지원

##### MacOS
- Alt · Shift · Ctrl 키 지원
- Cmd 키 추가 지원
  - `metaKey` <sub>(프로퍼티)</sub>

##### 대다수 응용프로그램 단축키 조합
- Ctrl <sub>(Windows · Linux)</sub>
  - Ctrl + Enter
  - Ctrl + A
- Cmd <sub>(MacOS)</sub>
  - Cmd + Enter
  - Cmd + A

##### Mac 사용자 지원 프로그램
- ex\) Ctrl 키 + `click` <sub>(이벤트)</sub>
  - == Cmd 키 + `click`<sub>(이벤트)</sub>

##### Ctrl 키 강제 시
- Ctrl 키 + 마우스 좌측 버튼
  - MacOS
    - == 마우스 우측 버튼
    - `contextMenu` <sub>(이벤트)</sub>
  - Windows · Linux
    - `click` <sub>(이벤트)</sub>

따라서 모든 사용자가 운영체제 종류에 상관없이 동일한 경험을 하게 하려면 `ctrlKey` 프로퍼티를 사용하는 코드엔 `metaKey`도 함께 넣어주세요.

`if (event.ctrlKey || event.metaKey)`같이 말이죠.

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **모바일 장치**

사용자가 키보드가 있는 기기를 사용할 경우, 단축키를 지원하면 사용자 경험을 상승시켜줄 수 있습니다.

그런데 모바일 장치같이 기기에 키보드가 없는 경우도 많기 때문에 사용자 경험을 해치지 않으려면 보조 키가 없는 사용자를 위한 지원하는 방법도 고려하며 프로그램을 만들어야 합니다.

<br />

### `clientX`, `clientY와` `pageX`, `pageY`
마우스 이벤트는 두 종류의 좌표 정보를 지원합니다.
1. 클라이언트 좌표: `clientX`와 `clientY`
2. 페이지 좌표: `pageX`와 `pageY`

두 정보에 대한 차이는 좌표 챕터에서 다룬 바 있습니다.

그럼에도 불구하고 두 좌표에 대해 요약하자면 다음과 같습니다. 클라이언트 좌표인 `clientX`와 `clientY`는 웹 문서를 기준으로 각각 좌측에서 얼마나 떨어져 있는지, 위에서 얼마나 떨어져 있는지를 나타내는데 페이지가 스크롤 되어도 변하지 않습니다. 반면 `pageX`와 `pageY`는 창 좌측 위를 기준으로 얼마나 떨어져 있는지를 나타내며 페이지를 스크롤하면 값도 변합니다.

예를 들어봅시다. 사이즈가 500x500인 창에서 마우스 커서를 좌측 위 가장자리로 옮기면 페이지를 어디로 스크롤 하든 상관없이 `clientX`, `clientY` 값이 `0`이 됩니다.

커서를 화면 정 가운데로 옮기면 마찬가지로 스크롤바 위치에 상관없이 `clientX`, `clientY` 값이 각각 `250`이 되죠. `position:fixed`와 유사하다고 보시면 됩니다.

커서를 `input` 필드 안으로 옮겨 `clientX`, `clientY` 값이 어떻게 변하는지 살펴봅시다. 참고로 아래 예시는 `iframe`안에서 구현되도록 해놓아서 좌표 정보가 `iframe`을 기준으로 계산됩니다.
```html
<input onmousemove="this.value=event.clientX+':'+event.clientY" value="Mouse over me">
```

![clientX-clientY-pageX-pageY](../../images/02/03/01/clientX-clientY-pageX-pageY.png)

### `mousedown` 이벤트와 선택 막기
글자 위에서 마우스를 더블클릭하면 글자가 선택되는데, 이런 기본 동작이 사용자 경험을 해칠 때가 있습니다.

`dblclick` 이벤트가 발생하면 얼럿 창을 띄우고 싶다고 가정해 봅시다. 제대로 코드를 작성했음에도 불구하고 핸들러가 실행되는 동시에 글자가 선택되는 불필요한 부수효과가 발생하였습니다.
```html
<span ondblclick="alert('dblclick')">이곳을 더블클릭해주세요.</span>
```

![mouse-event-and-preventing-selecting-1](../../images/02/03/01/mouse-event-and-preventing-selecting-1.png)

이 외에도 마우스 좌측 버튼을 누른 채 커서를 이리저리 움직이면 글자가 선택되는 부수효과 역시 사용자 경험을 해칠 수 있습니다.

이렇게 불필요하게 글자가 선택되는 것을 막아주는 방법은 다양한데, Selection and Range에서 확인해 볼 수 있습니다.

여러 방법 중, 예시에서 보여드린 상황에 가장 적합한 방법은 `mousedown` 이벤트가 발생할 때 나타나는 브라우저 기본 동작을 막는 것입니다. 이렇게 하면 글자가 선택되는 부수효과를 막을 수 있습니다.
```html
…
<b ondblclick="alert('클릭!')" onmousedown="return false">
  여기를 더블클릭해주세요.
</b>
…
```

![mouse-event-and-preventing-selecting-2](../../images/02/03/01/mouse-event-and-preventing-selecting-2.png)

기본 동작을 막았기 때문에 굵은 글씨가 있는 영역에서 더블클릭을 해도 단어가 선택되지 않고, 글자를 드래그해도 글자가 선택되지 않습니다.

그런데 이때 눈여겨봐야 할 점은 기본동작을 막았음에도 불구하고 글자를 선택할 수 있는 방법이 여전히 있다는 점입니다. `...`이 있는 부분부터 시작해 드래그를 시작하면 굵은 글씨를 선택할 수 있죠.

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **복사 막기**

콘텐츠를 보호하려는 목적으로 방문자가 내용을 복사, 붙여넣기 하는 걸 막으려면 `oncopy`라는 이벤트를 활용하면 됩니다.
```html
<div oncopy="alert('불법 복제를 예방하기 복사 기능을 막아놓았습니다!');return false">
  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent convallis ultrices lacus ut dictum. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.
</div>
```

![preventing-copying](../../images/02/03/01/preventing-copying.png)

바로위 상자 안에 있는 글자를 선택한 후 복사하려고하면 `oncopy` 이벤트의 기본 기능을 막아놓았기 때문에 복사가 안되는 것을 확인할 수 있습니다.

페이지 소스 보기를 할 수 있는 사용자라면 이런 방법이 소용이 없겠지만 모든 사용자가 소스 보기를 할 수 있는 건 아니기 때문에 이런 식으로 불법 복제를 어느 정도 막을 수 있죠.

<br />

## 요약
마우스 이벤트는 다음과 같은 프로퍼티를 지원합니다.

- 버튼 관련: `button`
- 보조키 관련: `altKey`, `ctrlKey`, `shiftKey`와 MacOS 전용 `metaKey`. 해당 키를 누른 경우에 프로퍼티 값이 `true`가 됩니다.
  - Ctrl를 고려한 코드를 작성하고 있다면 MacOS 사용자는 주로 Cmd 키를 사용한다는 점을 고려해서 `if (e.metaKey || e.ctrlKey)`같이 모든 사용자를 지원할 수 있도록 코드를 작성해야 합니다.
- 클라이언트 좌표 관련: `clientX`, `clientY`
- 페이지 좌표 관련: `pageX`, `pageY`

`mousedown` 이벤트가 발생하면 브라우저 기본 동작 때문에 글자가 선택됩니다. 이런 기본 동작이 사용자 경험을 해친다면 기본동작을 막아서 문제를 해결할 수 있습니다.

다음 챕터에선 포인터(커서)가 움직일 때 발생하는 이벤트와 포인터가 움직일 때 포인터 아래에 있는 요소들을 어떻게 추적할 수 있는지에 대해 자세히 다루겠습니다.

<br />

## <img src="../../images/commons/icons/circle-check-solid.svg" /> 과제

### 선택 가능한 리스트
파일 관리 프로그램처럼 요소를 선택할 수 있게 해주는 리스트를 만들어봅시다. 요구사항은 다음과 같습니다.
- 요소를 클릭하면 해당 요소가 선택(`.selected` 클래스 추가)되고, 나머지 요소들은 선택 해제됩니다.
- Ctrl키(Mac에서 Cmd키)를 누른 상태에서 요소를 클릭하면 해당 요소는 원래처럼 선택, 선택 해제되지만 다른 요소들의 상태는 변하지 않습니다(중복 요소 선택 기능).

데모:

![assignment-selectable-list](../../images/02/03/01/assignment-selectable-list.png)

참고 1: 항목들이 모두 텍스트이며 중첩 태그가 없다고 가정합니다.

참고 2: 텍스트를 클릭할 때 발생하는 브라우저 이벤트를 막습니다.

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/FJU208wBaHR7EFDt?p=preview)
