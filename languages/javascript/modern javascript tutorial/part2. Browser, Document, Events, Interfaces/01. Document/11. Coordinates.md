좌표
===

##### 대다수 JS 메서드
- 두 좌표 체계 중 하나 이용

##### 1. 창 기준
- 창 좌상단 모서리 기준
  - ≒ `position: fixed`
  - `clientX` · `clientY`

##### 2. 문서 기준
- 문서 좌상단 모서리 기준
  - ≒ `position: absolute` <sub>(문서 최상단)</sub>
  - `pageX` · `pageY`

##### 스크롤 이동 전
- 창 좌상단 모서리 · 문서 좌상단 모서리
  - 정확히 일치

##### 스크롤 이동 후
- 문서 기준 좌표 변경 X
- 창 기준 요소 좌표 변경
  - 창 내 요소 움직임

##### 문서 내 한 지점 스크롤 움직이기 전 <sub>(좌)</sub> 후 <sub>(우)</sub> 좌표 표시

![document-and-window-coordinates-scrolled](../../images/02/01/11/document-and-window-coordinates-scrolled.svg)

##### 문서 스크롤 되었을 때
- `pageY` <sub>(문서 기준 좌표)</sub>
  - 문서 맨 위부터 계산 <sub>(스크롤 되어 가려짐)</sub>
    - 좌표 동일
- `clientY` <sub>(창 기준 좌표)</sub>
  - 해당 지점 : 창 상단과 가까워짐
    - 좌표 변경 <sub>(화살표 짧아짐)</sub>

### `getBoundingClientRect` <sub>(요소 좌표 얻기)</sub>
- 해당 요소 감싸는 가장 작은 네모 창 기준 좌표
  - [`DOMRect`](https://www.w3.org/TR/geometry-1/#domrect) <sub>(클래스)</sub> 객체 형태 반환

#### `DOMRect`

##### 주요 프로퍼티
- `x` · `y`
  - 요소 감싸는 네모 창 기준 X · Y 좌표
- `width` · `height`
  - 요소 감싸는 네모 너비 · 높이 <sub>(음수 가능)</sub>

##### 파생 프로퍼티
- `top` · `bottom`
  - 요소 감싸는 네모 상 · 하 모서리 Y 좌표
- `left` · `right`
  - 요소 감싸는 네모 좌 · 우 모서리 X 좌표

##### 페이지 조금씩 스크롤 창 기준 버튼 위치 변경
- 버튼 클릭 시 좌푯값 변경
  - 수직 스크롤 시 변화
    - `y`
    - `top`
    - `bottom`

![get-bounding-client-rect-button](../../images/02/01/11/get-bounding-client-rect-button.png)

##### `getBoundingClientRect()` 각 프로퍼티

|좌표|계산|
|---|---|
|left|`x`|
|top|`y`|
|right|`x + width`|
|bottom|`y + height`|

![coordinates](../../images/02/01/11/coordinates.svg)

#### 주의사항

##### 소수 가능
- 좌표 계산 시 소수 사용 <sub>(브라우저)</sub>
- 반올림 필요 X
  - `style.[left·top]`

##### 음수 가능
- 페이지 스크롤 후
  - 요소 : window 위로 밀려났을 때

<br />

<img class="icon" src="../../images/commons/icons/circle-exclamation-solid.svg" /> **파생 프로퍼티 필요 이유 <sub>(`top` · `left`)</sub>**

- 편의 위해 존재

##### `width` · `height`
- '방향 있는' 사각형 : 음수 가능
  - 우하단 → 좌상단 <sub>(↖)</sub>

##### ex&#41; `width = -200` · `height = -100`
- `left` · `top` ≠ `x` · `y`

##### 실제 `getBoundingClientRect` <sub>(메서드)</sub>
- `width` · `height`
  - 항상 양수

![coordinates-negative](../../images/02/01/11/coordinates-negative.svg)

<br />

<img class="icon" src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **IE :  `x` · `y` 미지원**

#### 예전부터 미지원

##### 폴리필 추가
  - `DomRect.prototype`
    - getter 추가

##### `top` · `left` 사용
- `width` · `height` : 양수
  - `top` · `left` == `x` · `y`

<br />

<img class="icon" src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **`right` · `bottom` <sub>(좌표)</sub> ≠ `position` <sub>(CSS 프로퍼티)</sub>**

##### 창 기준 좌표 · `position: fixed` <sub>(CSS 프로퍼티)</sub>
- 명백한 유사점 존재

##### CSS
- `right` <sub>(프로퍼티)</sub>
  - 우측 모서리로부터의 거리
- `bottom` <sub>(프로퍼티)</sub>
  - 아래 모서리로부터의 거리

##### 창 기준 좌표 사용 시 주의
- 측정 기준 : 좌상단 모서리

<br />

### `elementFromPoint(x, y)`
- `(x, y)` <sub>(창 기준 좌표)</sub> 최근접 중첩 요소

##### 문법
```javascript
let elem = document.elementFromPoint(x, y);
```

##### 창 정중앙 요소 태그
- 얼럿창 출력
- 붉은색 강조
```javascript
let centerX = document.documentElement.clientWidth / 2;
let centerY = document.documentElement.clientHeight / 2;

let elem = document.elementFromPoint(centerX, centerY);

elem.style.background = "red";
alert(elem.tagName);
```

##### 창 기준 좌표 사용
- 현재 스크롤 위치 강조되는 요소
  - 상이 가능

<br />

<img class="icon" src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **창밖 좌표 대상 : `null`**

- 보이는 영역 안 <sub>(창 안)</sub> 위치 시만 동작

##### `null` 반환
- 좌표 <sub>`(x, y)`</sub> 중 하나라도
  - 음수
  - 창 너비 · 높이 이탈

##### 특징 미인지 시 전형적인 실수 발생
```javascript
let elem = document.elementFromPoint(x, y);

// 요소 : 창 밖으로 나가면
// - lem = null
elem.style.background = ''; // 에러!
```

<br />

### 창 내 특정 좌표에 요소 고정

##### 요소 근처 무언가 표시
- 요소 좌표 얻기
  - `getBoundingClientRect`
- `position` <sub>(CSS 프로퍼티)</sub>
  - `left` · `top` <sub>(또는 `right` · `bottom`)</sub>
    - 함께 사용

##### `createMessageUnder(elem, html)` <sub>(함수)</sub>
- `elem` <sub>(요소)</sub> 하단 메시지 표시
```javascript
let elem = document.getElementById("coords-show-mark");

function createMessageUnder(elem, html) {
  // 메시지 담길 요소 생성
  let message = document.createElement('div');

  // 요소 스타일링
  // - css 클래스 사용 권장
  message.style.cssText = "position: fixed; color: red";

  // 좌표를 지정
  // - "px" 주의
  let coords = elem.getBoundingClientRect();

  message.style.left = coords.left + "px";
  message.style.top = coords.bottom + "px";

  message.innerHTML = html;

  return message;
}

// 사용법
// - 문서 안 메시지 띄우기 (5초 동안)
let message = createMessageUnder(elem, '독도는 우리땅!');
document.body.append(message);
setTimeout(() => message.remove(), 5000);
```

![id-coords-show-mark-button-message](../../images/02/01/11/id-coords-show-mark-button-message.png)

##### 응용
- 좌 · 우 · 하단 표시
- CSS 애니메이션 적용
  - `fade-in` 등

##### 개선점
- 페이지 스크롤 시
  - 메시지 : 버튼에서 떨어짐

##### 이유
- 메시지 요소
  - `position: fixed`
- 페이지 스크롤 시
  - 창 기준 동일한 위치

##### 해결
- 문서 기준 좌표
- `position: absolute`

### 문서 기준 좌표
- 문서 좌상단 모서리부터 시작

##### CSS 유사점
- 창 기준 좌표
  - `position: fixed`
- 문서 기준 좌표
  - `position: absolute` <sub>(최상단 기준)</sub>

##### 문서 내 특정 좌표 위치시키기 <sub>(스크롤 이동 상관 X)</sub>
- 정확한 좌표
- `position: absolute`
- `top` · `left`

##### 문서 기준 요소 좌표 제공 표준 메서드
- 아직 부재
- 아주 쉽게 코드 작성

##### 두 좌표 체계 <sub>(창 · 문서 기준 좌표)</sub> 연관시키기
``` javascript
pageY == clientY + 문서 상 세로 스크롤 의해 밀려난 부분 높이
pageX == clientX + 문서 상 가로 스크롤 의해 밀려난 부분 너비
```

##### `getCoords(elem)`<sub>(함수)</sub>
1. 창 기준 좌쵸 표 얻기
  - `getBoundingClientRect()`
2. 스크롤 의해 가려진 영역 너비 · 높이 더하기
```javascript
// 문서 기준 요소 좌표 얻기
function getCoords(elem) {
  let box = elem.getBoundingClientRect();

  return {
    top:    box.top    + window.pageYOffset,
    right:  box.right  + window.pageXOffset,
    bottom: box.bottom + window.pageYOffset,
    left:   box.left   + window.pageXOffset
  };
}
```

##### `position: absolute` 사용 시
- 메시지 : 스크롤 해도 버튼 요소 근처 머무름

##### `createMessageUnder` <sub>(함수)</sub>
```javascript
function createMessageUnder(elem, html) {
  let message = document.createElement('div');
  message.style.cssText = "position: absolute; color: red";

  let coords = getCoords(elem);

  message.style.left = coords.left + "px";
  message.style.top = coords.bottom + "px";

  message.innerHTML = html;

  return message;
}
```

<br />

## 요약

#### 페이지 내 모든 점
- 좌표 보유

##### 1. 창 기준
- `gettBoundingClientRect()`
- `position: fixed` 함께 사용 시 유용

##### 2. 문서 기준
- `getBoundingClientRect()` + 현재 스크롤 상태
- `position: absolute` 함께 사용 시 유용

두 좌표 체계 모두 장단점이 있습니다. CSS의 `position`, `absolute`, `fixed`처럼 이게 필요할 때도 있고 저게 필요할 때도 있습니다.

<br />

## <img class="icon" src="../../images/commons/icons/circle-check-solid.svg" /> 과제

### Find window coordinates of the field
In the iframe below you can see a document with the green “field”.

Use JavaScript to find window coordinates of corners pointed by with arrows.

There’s a small feature implemented in the document for convenience. A click at any place shows coordinates there.

![assignment-find-window-coordinates-of-the-field](../../images/02/01/11/assignment-find-window-coordinates-of-the-field.png)

Your code should use DOM to get window coordinates of:
1. Upper-left, outer corner (that’s simple).
2. Bottom-right, outer corner (simple too).
3. Upper-left, inner corner (a bit harder).
4. Bottom-right, inner corner (there are several ways, choose one).

The coordinates that you calculate should be the same as those returned by the mouse click.

P.S. The code should also work if the element has another size or border, not bound to any fixed values.

<br />

<img class="icon" src="../../images/commons/icons/circle-answer.svg" />

##### Outer corners
Outer corners are basically what we get from [`elem.getBoundingClientRect()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect).

Coordinates of the upper-left corner `answer1` and the bottom-right corner `answer2`:
```javascript
let coords = elem.getBoundingClientRect();

let answer1 = [coords.left, coords.top];
let answer2 = [coords.right, coords.bottom];
```

##### Left-upper inner corner
That differs from the outer corner by the border width. A reliable way to get the distance is `clientLeft`/`clientTop`:
```javascript
let answer3 = [coords.left + field.clientLeft, coords.top + field.clientTop];
```

##### Right-bottom inner corner
In our case we need to substract the border size from the outer coordinates.

We could use CSS way:
```javascript
let answer4 = [
  coords.right - parseInt(getComputedStyle(field).borderRightWidth),
  coords.bottom - parseInt(getComputedStyle(field).borderBottomWidth)
];
```

An alternative way would be to add `clientWidth`/`clientHeight` to coordinates of the left-upper corner. That’s probably even better:
```javascript
let answer4 = [
  coords.left + elem.clientLeft + elem.clientWidth,
  coords.top + elem.clientTop + elem.clientHeight
];
```

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/w1mwumfvKPR3ApJc?p=preview&preview)

<hr />

### Show a note near the element
Create a function `positionAt(anchor, position, elem)` that positions `elem`, depending on position near `anchor` element.

The `position` must be a string with any one of 3 values:
- `"top"` – position `elem` right above `anchor`
- `"right"` – position `elem` immediately at the right of `anchor`
- `"bottom"` – position `elem` right below `anchor`

It’s used inside function `showNote(anchor, position, html)`, provided in the task source code, that creates a “note” element with given `html` and shows it at the given `position` near the `anchor`.

Here’s the demo of notes:

![assignment-show-a-note-near-the-element](../../images/02/01/11/assignment-show-a-note-near-the-element.png)

<br />

<img class="icon" src="../../images/commons/icons/circle-answer.svg" />

In this task we only need to accurately calculate the coordinates. See the code for details.

Please note: the elements must be in the document to read `offsetHeight` and other properties. A hidden (`display:none`) or out of the document element has no size.

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/TY4R2je7qdqDBOgZ?p=preview)

<hr />

### Show a note near the element (absolute)
Modify the solution of the previous task so that the note uses `position:absolute` instead of `position:fixed`.

That will prevent its “runaway” from the element when the page scrolls.

Take the solution of that task as a starting point. To test the scroll, add the style `<body style="height: 2000px">`

<br />

<img class="icon" src="../../images/commons/icons/circle-answer.svg" />

The solution is actually pretty simple:
- Use `position:absolute` in CSS instead of `position:fixed` for `.note`.
- Use the function getCoords() from the chapter 좌표 to get document-relative coordinates.

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/TY4R2je7qdqDBOgZ?p=preview)

<hr />

### Position the note inside (absolute)
Extend the previous task [Show a note near the element (absolute)](https://ko.javascript.info/task/position-at-absolute): teach the function `positionAt(anchor, position, elem)` to insert `elem` inside the `anchor`.

New values for `position`:
- `top-out`, `right-out`, `bottom-out` – work the same as before, they insert the `elem` over/right/under `anchor`.
- `top-in`, `right-in`, `bottom-in` – insert `elem` inside the `anchor`: stick it to the upper/right/bottom edge.

For instance:
```javascript
// shows the note above blockquote
positionAt(blockquote, "top-out", note);

// shows the note inside blockquote, at the top
positionAt(blockquote, "top-in", note);
```

The result:

![assignment-position-the-note-inside-absolute](../../images/02/01/11/assignment-position-the-note-inside-absolute.png)

As the source code, take the solution of the task [Show a note near the element (absolute)](https://ko.javascript.info/task/position-at-absolute).
- above assignment

<br />

<img class="icon" src="../../images/commons/icons/circle-answer.svg" />

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/vYfLijXlrNezxdcV?p=preview)
