좌표
====

#### 좌표 체계 <sub>(2가지 · 대다수 JS 메서드 둘 중 하나 이용)</sub>

##### 1. 창 기준
- 창 좌상단 모서리 기준
- `position: fixed` 유사
- (`clientX`, `clientY`) <sub>(좌표)</sub>

##### 2. 문서 기준
- 문서 좌상단 모서리 기준
- `position: absolute` <sub>(문서 최상단)</sub> 유사
- (`pageX`, `pageY`) <sub>(좌표)</sub>

##### 스크롤 이동 전
- 창 · 문서 좌상단 모서리 일치

##### 스크롤 이동 후
- 창 기준 요소 좌표 변경 <sub>(창 내 요소 이동)</sub>
- 문서 기준 좌표 동일

#### 문서 내 한 지점 좌표 <sub>(스크롤 이동 전 · 후)</sub>

![document-and-window-coordinates-scrolled](../../images/02/01/11/document-and-window-coordinates-scrolled.svg)

##### `clientY` <sub>(창 기준 좌표)</sub>
- 창 최상단 <sub>(스크롤 시 거리 근접)</sub> 부터 계산
  - 스크롤 후 좌표 변경 <sub>(화살표 길이 ↓)</sub>

##### `pageY` <sub>(문서 기준 좌표)</sub>
- 문서 최상단 <sub>(스크롤 의해 가려짐)</sub> 부터 계산
  - 스크롤 후 좌표 동일

### 창 기준 <sub>(요소)</sub> 좌표

##### `getBoundingClientRect()` <sub>(요소 메서드)</sub>
- `DOMRect` <sub>(객체)</sub> 반환
  - 요소 감싸는 가장 작은 박스 좌표 <sub>(창 기준)</sub>

#### [`DOMRect`](https://www.w3.org/TR/geometry-1/#domrect) <sub>(클래스)</sub>

![coordinates](../../images/02/01/11/coordinates.svg)

##### 주요 프로퍼티
- `x` · `y`
  - 박스 X · Y 좌표 <sub>(창 기준)</sub>
- `width` · `height` <sub>(음수 가능)</sub>
  - 박스 너비 · 높이

##### 파생 프로퍼티
- `left` <sub>(`x`)</sub> · `right` <sub>(`x` + `width`)</sub>
  - 박스 좌 · 우 모서리 X 좌표 <sub>(창 기준)</sub>
- `top` <sub>(`y`)</sub> · `bottom` <sub>(`y` + `height`)</sub>
  - 박스 상 · 하 모서리 Y 좌표 <sub>(창 기준)</sub>

#### 주의

##### 소수 가능
- 좌표 계산 시 소수 사용 <sub>(브라우저)</sub>
  - 반올림 불필요 <sub>(`style.[left·top]` 등)</sub>

##### 음수 가능
- 스크롤 후 창 외부 <sub>(최상단 위)</sub> 요소 위치 시
  - `top` <sub>(파생 프로퍼티)</sub> 값 음수

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **파생 프로퍼티 필요 이유 <sub>(편의 도모)</sub>**

#### `width` · `height` <sub>(주요 프로퍼티)</sub>

##### '방향성' 박스 표시 가능 <sub>(마우스 드래그 등)</sub>
- 우하단 → 좌상단 <sub>(↖)</sub>
  - 음수 값

##### `width = -200` · `height = -100`
- `x` ≠ `left`
- `y` ≠ `top`

![coordinates-negative](../../images/02/01/11/coordinates-negative.svg)

##### 실제 값 항상 양수
- 이론상 음수 가능

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **IE `x` · `y` 미지원**

#### 해결 <sub>(2가지 방법)</sub>

##### ⓐ 폴리필 추가
  - `DomRect.prototype`
    - getter 추가

##### ⓑ `left` · `top` <sub>(파생 프로퍼티)</sub> 사용
- `width` · `height` <sub>(주요 프로퍼티)</sub> 값 양수 경우
  - `x` → `left`
  - `y` → `top`

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **`right` · `bottom` <sub>(좌표 vs CSS)</sub>**

##### 창 기준 좌표 · `position: fixed` <sub>(CSS 프로퍼티)</sub>
- 명백한 유사점 有

#### 측정 기준 상이

##### 창 기준 좌표
- 좌상단 모서리

##### `position: fixed` <sub>(CSS 프로퍼티)</sub>
- `right` <sub>(CSS 프로퍼티)</sub>
  - 우측 모서리
- `bottom` <sub>(CSS 프로퍼티)</sub>
  - 하단 모서리

<br />

### `elementFromPoint(x, y)` <sub>(메서드)</sub>

##### `document.elementFromPoint(x, y)`
- `(x, y)` <sub>(창 기준 좌표)</sub> 최근접 중첩 요소 반환
```javascript
let elem = document.elementFromPoint(x, y);
```

##### 창 정중앙 요소 대상 동작
- 붉은색 강조 · 태그 얼럿창 출력
- 현재 스크롤 위치 강조 요소
  - 상이 가능 <sub>(창 기준 좌표)</sub>
```javascript
let centerX = document.documentElement.clientWidth / 2;
let centerY = document.documentElement.clientHeight / 2;

let elem = document.elementFromPoint(centerX, centerY);

// 붉은색 강조
elem.style.background = "red";

// 태그 얼럿창 출력
alert(elem.tagName);
```

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **창 외부 좌표 대상 == `null`**

##### `document.elementFromPoint(x, y)`
- 가시 영역 <sub>(창)</sub> 내 대상만 동작

##### `null` 반환 의미
- `(x, y)` <sub>(좌표)</sub> 중 최소 하나
  - 음수
  - 창 너비 · 높이 이탈

##### 해당 특징 미인지 시 전형적인 실수 발생 가능
```javascript
let elem = document.elementFromPoint(x, y);

// 창 외부 요소 이탈 시
// - elem (변수) == null
elem.style.background = ''; // 에러
```

<br />

### 창 내 특정 좌표 요소 고정

##### 좌표 주요 용도
- 위치 설정

#### 요소 근처 위치 내 표시

##### 1. 특정 요소 좌표 얻기
- `getBoundingClientRect()` <sub>(메서드)</sub>

##### 2. 근처 위치 내 표시 <sub>(CSS · 좌표 조합)</sub>
- `position` <sub>(CSS 프로퍼티)</sub>
  - `style.left`
  - `style.right`
  - `style.top`
  - `style.bottom`
- 창 기준 좌표 <sub>(`DOMRect` 객체 파생 프로퍼티)</sub>
  - `left`
  - `right`
  - `top`
  - `bottom`

##### `createMessageUnder(elem, html)` <sub>(함수)</sub>
- `elem` <sub>(요소)</sub> 하단 `html` <sub>(메시지)</sub> 표시
```javascript
function createMessageUnder(elem, html) {

  // 메시지 표시 요소 생성
  let message = document.createElement('div');

  // 요소 스타일링 (CSS 클래스 사용 권장)
  message.style.cssText = "position: fixed; color: red";

  // 좌표 지정
  // - px (단위) 추가 주의
  let coords = elem.getBoundingClientRect();

  message.style.left = coords.left + "px";
  message.style.top = coords.bottom + "px";

  message.innerHTML = html;

  return message;
}

// 사용법
// - 5초간 문서 내 메시지 표시
let elem = document.getElementById("coords-show-mark");
let message = createMessageUnder(elem, '독도는 우리땅!');
document.body.append(message);
setTimeout(() => message.remove(), 5000);
```

![id-coords-show-mark-button-message](../../images/02/01/11/id-coords-show-mark-button-message.png)

##### 응용
- 상 · 하 · 좌 · 우 <sub>(요소 기준)</sub> 표시
- CSS 애니메이션 <sub>(`fade-in` 등)</sub> 적용

페이지를 스크롤 하면 메시지가 버튼에서 떨어지네요.

#### 개선점

##### 문제
- 페이지 스크롤 시
  - 기준 요소 · 메시지 벌어짐

메시지가 버튼에서 떨어지는 이유는 아주 명확합니다. 메시지 요소가 position:fixed이기 때문에 페이지가 스크롤 되어도 창 기준 동일한 위치에 있기 때문입니다.

이런 부자연스러운 현상을 개선하려면 문서 기준 좌표와 position:absolute를 함께 사용해야 합니다.

##### 이유
- 메시지 요소
  - `position: fixed` <sub>(CSS 프로퍼티)</sub>
    - 창 기준 위치 <sub>(좌표)</sub> 고정
- 페이지 스크롤 시 위치 변경 X
  - 창 기준 동일 위치 표시 <sub>(스크롤 무관)</sub>

##### 해결 <sub>(함께 사용)</sub>
- 문서 기준 좌표
- `position: absolute` <sub>(CSS 프로퍼티)</sub>

### 문서 기준 좌표

##### 좌표 기준
- 문서 좌상단 모서리

##### `position` <sub>(CSS 프로퍼티)</sub> 유사점
- 창 기준 좌표
  - `position: fixed`
- 문서 기준 좌표
  - `position: absolute` <sub>(최상단 적용)</sub>

##### 문서 내 특정 좌표 위치시키기 <sub>(스크롤 이동 무관)</sub>
- `position: absolute` <sub>(CSS 프로퍼티)</sub>
- `top` · `left` <sub>(프로퍼티)</sub>
- 문서 기준 좌표

##### 문서 기준 좌표 제공 표준 메서드
- 아직 부재
- 아주 쉽게 코드 작성

##### 두 좌표 체계 <sub>(창 · 문서 기준 좌표)</sub> 연관시키기
``` javascript
pageY == clientY + 문서 상 세로 스크롤 의해 밀려난 부분 높이
pageX == clientX + 문서 상 가로 스크롤 의해 밀려난 부분 너비
```

##### `getCoords(elem)` <sub>(함수)</sub>
1. 창 기준 좌표 얻기
    - `getBoundingClientRect()`
2. 스크롤 의해 가려진 영역 너비 · 높이 더하기
```javascript
// 문서 기준 요소 좌표 얻기
function getCoords(elem) {

  // ①
  // 창 기준 좌표 얻기
  let box = elem.getBoundingClientRect();

  return {
    // ②
    // 스크롤 의해 가려진 영역 너비 · 높이 더하기
    top:    box.top    + window.pageYOffset,
    right:  box.right  + window.pageXOffset,
    bottom: box.bottom + window.pageYOffset,
    left:   box.left   + window.pageXOffset
  };
}
```

##### 개선된 `createMessageUnder` <sub>(함수)</sub>
```javascript
function createMessageUnder(elem, html) {
  let message = document.createElement('div');
  message.style.cssText = "position: absolute; color: red";

  let coords = getCoords(elem);

  message.style.left = coords.left + "px";
  message.style.top = coords.bottom + "px";

  message.innerHTML = html;

  return message;
}
```

<br />

요약
====

#### 페이지 내 모든 점 보유 좌표 <sub>(2가지)</sub>

##### 1. 창 기준 좌표 <sub>(`position: fixed` 함께 사용 시 유용)</sub>
- `getBoundingClientRect()` <sub>(메서드)</sub>

##### 2. 문서 기준 좌표 <sub>(`position: absolute` 함께 사용 시 유용)</sub>
- `getBoundingClientRect()` <sub>(메서드)</sub>
- 현재 스크롤 상태

<br />

## <img src="../../images/commons/icons/circle-check-solid.svg" /> 과제

### 창 기준 좌표 구하기

##### 화살표 표시 부분 창 기준 좌표 얻기
1. 좌상단 외부 모서리
2. 우하단 외부 모서리
3. 좌상단 내부 모서리
4. 우하단 내부 모서리

##### 편의 기능 사용 가능
- 요소 내 클릭 시
  - 클릭 지점 좌표 출력

##### 조건
- 두 좌표 <sub>(화살표 표시 부분)</sub> 동일
  - 계산값
  - 마우스 클릭 시 출력값

##### 참고
- 요소 · 테두리 크기 관계 없이 작동

![assignment-find-window-coordinates-of-the-field](../../images/02/01/11/assignment-find-window-coordinates-of-the-field.png)

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

##### 외부 모서리 좌표
- [`getBoundingClientRect()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect) <sub>(메서드)</sub>
```javascript
let coords = elem.getBoundingClientRect();

// 좌상단
let answer1 = [coords.left , coords.top];

// 우하단
let answer2 = [coords.right, coords.bottom];
```

#### 내부 모서리 좌표
- 테두리 두께 고려

##### 좌상단 내부 모서리 좌표
- 좌상단 외부 모서리 좌표 + 테두리 두께
  - `client[Left·Top]`
```javascript
let answer3 = [coords.left + field.clientLeft, coords.top + field.clientTop];
```

##### 우하단 내부 모서리 좌표
1. 우하단 외부 모서리 좌표 - 테두리 두께
```javascript
// CSS 이용
let answer4_1 = [
  coords.right  - parseInt(getComputedStyle(field).borderRightWidth),
  coords.bottom - parseInt(getComputedStyle(field).borderBottomWidth)
];
```

2. 좌상단 외부 모서리 좌표 + 테두리 두께 + 요소 너비 · 높이
```javascript
// client[Width·Height] 이용
// - 좌상단 모서리 좌표
let answer4_2 = [
  coords.left + elem.clientLeft + elem.clientWidth,
  coords.top  + elem.clientTop  + elem.clientHeight
];
```

[정답](https://plnkr.co/edit/w1mwumfvKPR3ApJc?p=preview)

<hr />

### 요소 근처에 노트 표시하기 <sub>(상대값 좌표)</sub>

##### `positionAt(anchor, position, elem)` <sub>(함수)</sub> 작성
- `elem` <sub>(요소)</sub> 위치 설정
  - `anchor` <sub>(인수)</sub> 근처 <sub>(외부)</sub>

##### `position` <sub>(CSS 프로퍼티)</sub> 값 <sub>(문자열)</sub>
- `"top"`
  - `anchor` <sub>(인수)</sub> 상단
- `"right"`
  - `anchor` <sub>(인수)</sub> 우측
- `"bottom"`
  - `anchor` <sub>(인수)</sub> 하단

##### `showNote(anchor, position, html)` <sub>(함수)</sub> 내 사용됨
- `note` <sub>(요소)</sub> 생성
  - 내용 : `html` <sub>(인수)</sub>
  - 위치 : `position` <sub>(인수)</sub>
    - `anchor` <sub>(인수)</sub> 근처

##### 결과물
![assignment-show-a-note-near-the-element](../../images/02/01/11/assignment-show-a-note-near-the-element.png)

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

##### 정확한 좌표 계산 필요
- 코드 참조

##### 참고
- 요소 : 문서 내 위치 필요
  - 프로퍼티 값 필요 <sub>(`offsetHeight` 등)</sub>
- 숨겨진 · 문서 외부 요소
  - 크기 : 0

[정답](https://plnkr.co/edit/TY4R2je7qdqDBOgZ?p=preview)

<hr />

### 요소 근처에 노트 표시하기 <sub>(절대값 좌표)</sub>

##### 이전 과제 정답 <sub>(함수)</sub> 변형
- `position: absolute` 사용
  - 스크롤 시 요소 이동 방지

##### 스타일 추가
- 스크롤 이동 테스트
``` javascript
<body style="height: 2000px">
```

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

##### 이전 과제 정답 <sub>(함수)</sub> 코드 변형 <sub>(2가지)</sub>
1. `position: [fixed → absolute]`
    - `.note` <sub>(CSS 클래스)</sub>
2. `getCoords()` <sub>('좌표 챕터' 함수)</sub> 사용
    - 문서 기준 좌표 얻기

[정답](https://plnkr.co/edit/TY4R2je7qdqDBOgZ?p=preview)

<hr />

### 요소 내 노트 표시하기 <sub>(절대값 좌표)</sub>

##### 이전 과제 정답 <sub>(함수)</sub> 확장
- `positionAt(anchor, position, elem)` <sub>(함수)</sub>

##### `elem` <sub>(요소)</sub> 추가 위치 설정
- `anchor` <sub>(인수)</sub> 내부
#### `position` <sub>(인수)</sub> 새 값
- `"[top·right·bottom]-out"`
  - `anchor` 기준 외부 <sub>(이전 기능 동일)</sub>
- `"[top·right·bottom]-in"`
  - `anchor` 기준 내부 <sub>(테두리에 붙음)</sub>
```javascript
// 요소 외부 상단
positionAt(blockquote, "top-out", note);

// 요소 내부 상단
positionAt(blockquote, "top-in" , note);
```

##### 결과물

![assignment-position-the-note-inside-absolute](../../images/02/01/11/assignment-position-the-note-inside-absolute.png)

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

[정답](https://plnkr.co/edit/vYfLijXlrNezxdcV?p=preview)
