`focus` · `blur` <sub>(이벤트)</sub>
============

##### 요소 포커스 <sub>(`focus`)</sub>
- 폼 요소 클릭
- Tab 키 눌러 해당 폼 요소 이동
- `autofocus` <sub>(속성)</sub>
  - 페이지 로드 후 자동 포커스
- 기타 등등

##### 포커스 의미
- '여기에 데이터 입력할 준비하라'
- 요소 포커싱 순간
  - 요구사항 충족 초기화 코드 실행 가능

##### 요소 포커스 해제 <sub>(`blur`)</sub>
- 다른 폼 요소 클릭
- Tab 키 눌러 다음 폼 필드 이동
- 기타 등등

##### 포커스 해제 의미
- '데이터 입력 완료되었다'
- 포커싱 해제 순간
  - 데이터 체크
  - 서버 요청 전송 <sub>(데이터 저장)</sub>
  - 기타 등등

### `focus` · `blur` <sub>(이벤트)</sub>
- 요소 포커스 받을 · 잃을 때 발생

##### 입력 필드 값 검증
- `blur` 핸들러
  - 필드 내 입력 이메일 확인
  - 부정확한 입력 시
    - 에러 표시
- `focus` 핸들러
  - 에러 메시지 숨기기
  - 이메일 재확인
    - `blur` 핸들러
```html
<style>
  .invalid { border-color: red; }
  #error { color: red }
</style>

이메일: <input type="email" id="input">

<div id="error"></div>

<script>
input.onblur = function() {

  // 이메일 유효성 체크
  // - '@' 유무 여부
  if (!input.value.includes('@')) {
    input.classList.add('invalid');
    error.innerHTML = '올바른 이메일 주소를 입력하세요.'
  }
};

input.onfocus = function() {
  if (this.classList.contains('invalid')) {

    // 사용자 새 값 입력 위해 <input> (필드) 다시 선택
    // -  에러 메시지 제거
    this.classList.remove('invalid');
    error.innerHTML = "";
  }
};
</script>
```

![focus-blur-event](../../images/02/04/02/focus-blur-event.png)

#### 모던 HTML

##### 다양한 속성 사용해 입력값 검증 가능
- `required`
- `pattern`
- 기타 등등

##### JS 사용 이유
- 좀 더 유연
- 추가 동작 가능
  - 입력값 자동 서버 전송
  - 기타 등등

### `focus` · `blur` <sub>(메서드)</sub>
- 요소 포커스 설정 · 제거

##### 입력 값 검증
- 방문자 무효 값 <sub>(이메일)</sub> 입력 시
  - 사이트에 잡아놓기
```html
<style>
  .error {
    background: red;
  }
</style>

이메일: <input type="email" id="input">
<input type="text" style="width:220px" placeholder="이메일 형식이 아닌 값을 입력하고 여기에 포커스를 주세요.">

<script>
  input.onblur = function() {

    // 무효 값
    // - 유효 이메일 X
    if (!this.value.includes('@')) {

      // 에러 출력
      this.classList.add("error");

      // input (필드) 포커스
      input.focus();

    } else {
      this.classList.remove("error");
    }
  };
</script>
```

![focus-blur-method](../../images/02/04/02/focus-blur-method.png)

##### 대다수 브라우저 정상 동작
- Firefox [<sub>(bug)</sub>](https://bugzilla.mozilla.org/show_bug.cgi?id=53579) 제외

##### 무효 이메일 값 입력 후 `<input>` 벗어나기
- Tab 키 · 다른 곳 클릭 시
  - `onblur` 핸들러 동작
    - 포커스 → 입력 필드 재설정

##### `onblur` <sub>(이벤트)</sub>
- 요소 포커스 해제 후 발생
- 핸들러 내 `preventDefault()` 호출
  - 포커스 해제 막기 X

<br />

<img src="../../images/commons/icons/triangle-exclamation-solid.svg" /> **JS 유발 포커스 해제**

#### JS 자체 포커스 해제 경우 有

##### `alert` <sub>(함수)</sub>
- 자기 자신 포커스 설정
  - 기존 요소 포커스 해제 발생 <sub>(`blur` 이벤트)</sub>
- 함수 종료 후
  - 기존 요소 포커스 다시 설정 <sub>(`focus` 이벤트)</sub>

##### DOM 내 요소 제거 · 추가
- DOM 요소 제거 시
  - 포커스 해제 발생 <sub>(`blur` 이벤트)</sub>
- 추후 DOM 내 재삽입 시
  - 포커스 설정 미발생
- `focus` · `blur` 핸들러
  - 오작동 가능성 有

##### 최선
- 이벤트 사용 시 주의
- 사용자 유발 포커스 이벤트 추적 시
  - JS 유발 포커스 이벤트 주의

<br />

### 모든 요소 포커스하기 <sub>(`tabindex`)</sub>

##### 대다수 요소 <sub>(브라우저별 상이)</sub>
- 포커싱 미지원

#### `focus` · `blur` <sub>(이벤트 · 메서드)</sub> 지원 여부

##### 사용자 · 웹 페이지 상호작용 요소 지원
- `<button>`
- `<input>`
- `<select>`
- `<a>`
- 기타 등등

##### 표시 용도 요소 미지원 <sub>(`tabindex` 속성 사용)</sub>
- `<div>`
- `<span>`
- `<table>`
- 기타 등등

##### `tabindex` <sub>(속성)</sub> 요소
- 포커스 가능
  - 종류 무관
- 값 <sub>(숫자)</sub>
  - Tab 키 눌러 요소 이동 시 순서

##### 포커싱 요소 순서 <sub>(Tab 키 눌러 이동)</sub>
1. `<… tabindex="1">`
2. `<… tabindex="2">`
3. `<… tabindex="n">`
4. `<input …>` <sub>(상호작용 요소)</sub>
5. `<a …>` <sub>(상호작용 요소)</sub>
6. …

##### `tabindex` <sub>(속성)</sub> 부재 상호작용 요소 순서
- 기본 순서
  - 문서 내 순서 따라 이동

##### `<… tabindex="0">` <sub>(요소)</sub>
- `tabindex` <sub>(속성)</sub> 부재 동일
- 용도
  - 포커스 활성화
  - 기본 순서 유지

##### `<… tabindex="-1">` <sub>(요소)</sub>
- JS 전용 포커스 활성화
  - Tab 키 누르기 무시
  - `elem.focus()` <sub>(메서드)</sub>
    - 포커싱 작동

##### 1번째 항목 클릭 후 Tab 키 누르기
```html
첫 번째 항목을 클릭하고 Tab 키를 눌러보면서 포커스 된 요소 순서를 눈여겨보세요.
참고로 탭을 많이 누르면 예시 밖으로 포커스가 이동하니, 주의하세요.
<ul>
  <li tabindex="1">일</li>
  <li tabindex="0">영</li>
  <li tabindex="2">이</li>
  <li tabindex="-1">음수 일</li>
</ul>

<style>
  li { cursor: pointer; }
  :focus { outline: 1px dashed green; }
</style>
```

![tabindex-focusing-on-all-element](../../images/02/04/02/tabindex-focusing-on-all-element.png)

##### 포커스 이동 순서
1. `<li tabindex="1">일</li>`
2. `<li tabindex="2">이</li>`
3. `<li tabindex="0">영</li>`

##### `<li>` <sub>(요소)</sub>
- 포커스 불가능 요소
- `tabindex` <sub>(속성)</sub> 사용
  - 포커스 활성화
- 포커스 된 요소 스타일
  - `:focus` <sub>(가상 클래스)</sub>

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **`elem.tabIndex` <sub>(프로퍼티)</sub> 사용 가능**

##### JS 사용해 `tabIndex` <sub>(프로퍼티)</sub> 추가
- `tabindex` <sub>(속성)</sub> 사용 동일 효과

<br />

### `focus[in·out]` <sub>(이벤트)</sub> · 이벤트 위임

##### `focus` · `blur` <sub>(이벤트)</sub>
- 버블링 X

##### `<form>` <sub>(요소)</sub> 설정 `onfocus` 핸들러
- 작동 X
```html
<!-- 폼 내 요소 포커스 설정 시 클래스 추가 -->
<form onfocus="this.className='focused'">
  <input type="text" name="surname" value="성">
  <input type="text" name="name" value="이름">
</form>

<style> .focused { outline: 1px solid red; } </style>
```

![focusin-focusout-event-delegation](../../images/02/04/02/focusin-focusout-event-delegation.png)

##### `form.onfocus` <sub>(핸들러)</sub> 동작 X
- `<input>` <sub>(요소)</sub> 포커스 설정 시
  - 해당 입력 필드에만 `focus` <sub>(이벤트)</sub> 발생
  - 버블링 X

#### 이벤트 위임 설정 방법 <sub>(2가지)</sub>

##### 1. 캡처링 이용
- `focus` · `blur` <sub>(이벤트)</sub>
  - 버블링 X
  - 캡쳐링 발생
```html
<form id="form">
  <input type="text" name="surname" value="성">
  <input type="text" name="name" value="이름">
</form>

<style> .focused { outline: 1px solid red; } </style>

<script>
  // 캡쳐링 단계 작동 설정
  // - 마지막 인수
  //   - true 전달
  form.addEventListener("focus", () => form.classList.add('focused'), true);
  form.addEventListener("blur", () => form.classList.remove('focused'), true);
</script>
```

![focusin-focusout-event-delegation](../../images/02/04/02/focusin-focusout-event-delegation.png)

##### 2. `focus[in·out]` <sub>(이벤트)</sub> 이용
- `focus` · `blur` <sub>(이벤트)</sub> 동일
  - 버블링 발생
- `on<event>` <sub>(HTML 속성 · DOM 프로퍼티)</sub> X
  - `addEventListener` <sub>(메서드)</sub> 사용

예시를 실행해 실제 이벤트가 버블링 되는지 확인해봅시다.
```html
<form id="form">
  <input type="text" name="surname" value="성">
  <input type="text" name="name" value="이름">
</form>

<style> .focused { outline: 1px solid red; } </style>

<script>
  form.addEventListener("focusin", () => form.classList.add('focused'));
  form.addEventListener("focusout", () => form.classList.remove('focused'));
</script>
```

![focusin-focusout-event-delegation](../../images/02/04/02/focusin-focusout-event-delegation.png)

<br />

## 요약
`focus`와 `blur` 이벤트는 각각 요소가 포커스를 받을 때, 잃을 때 발생합니다.

두 이벤트를 사용할 땐 다음을 유의해야 합니다.
- `focus`와 `blur` 이벤트는 버블링 되지 않습니다. 캡처링이나 `focusin`, `focusout`을 사용하면 이벤트 위임 효과를 볼 수 있습니다.
- 대부분의 요소는 기본적으로 포커스를 지원하지 않습니다. 그럼에도 불구하고 포커스 하고 싶은 요소가 있다면 `tabindex`를 사용하면 됩니다.

현재 포커스된 요소는 `document.activeElement`를 통해 확인할 수 있습니다.

<br />

## <img src="../../images/commons/icons/circle-check-solid.svg" /> 과제

### 수정 가능한 `div`
중요도: 5
클릭하면 `<textarea>`로 변하는 `<div>`를 만들어보세요.

`textarea`에선 `<div>` 안에있는 HTML을 수정할 수 있어야 합니다.

사용자가 Enter를 누르거나 `textarea` 요소가 포커스를 잃으면 `<textarea>`는 다시 `<div>`로 변해야 하고 textarea에 입력했던 콘텐츠는 `<div>`안 HTML이 되어야 합니다.

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/pE9UdaOM7XbZMDGJ?p=preview)

<hr />

### 클릭해서 TD 수정하기
셀을 클릭하면 해당 셀을 수정할 수 있게 해주는 테이블을 만들어보세요.
- 셀 클릭 시 셀 안에 `textarea`가 나타나면서 셀에 들어 있는 콘텐츠(HTML)를 '수정'할 수 있어야 합니다. 이때 `textarea` 크기는 기존 `cell` 크기와 같아야 합니다.
- 셀 수정 시 셀 하단에 '완료'와 '취소' 버튼이 노출되도록 하고, 각 버튼을 누르면 수정이 종료, 취소될 수 있게 합니다.
- 한 번에 하나의 셀만 수정할 수 있어야 합니다. `<td>`가 '수정 중'일 때는 다른 셀을 눌러도 클릭 이벤트가 무시되어야 합니다.
- 테이블엔 더 많은 셀이 추가될 수 있으므로 이벤트 위임을 사용하세요.

데모:

![assignment-click-td-modifying](../../images/02/04/02/assignment-click-td-modifying.png)

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

1. 셀 클릭 시 셀의 `innerHTML`을 `<textarea>`로 교체합니다. 이때 기존 `<textarea>`는 기존 셀의 크기와 같고, 테두리(border)가 없습니다. 크기 지정엔 자바스크립트를 사용해도 되고, CSS를 사용해도 됩니다.
2. `textarea.value`를 `td.innerHTML`과 같게 설정합니다.
3. `textarea`에 포커스를 줍니다.
4. 셀 아래에 완료, 취소 <sub>(버튼)</sub> 을 보여주고, 버튼에 적절한 핸들러를 달아줍니다.
샌드박스를 열어 정답을 확인해보세요.

<hr />

### 키보드로 쥐 움직이기
쥐에 포커스를 준 다음 화살표 키를 이용해서 쥐를 움직여봅시다.

[새 창에서 데모 보기](https://ko.js.cx/task/keyboard-mouse/solution/)

참고
1. `#mouse` 요소 이 외의 어느 곳에도 이벤트 핸들러를 달지 마세요.
2. HTML과 CSS를 수정하지 마세요. 작성할 자바스크립트는 어떤 요소에서도 동작할 수 있는 범용성이 있어야 합니다.

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

`mouse.onclick`으로 클릭 이벤트를 핸들링하고 `position:fixed`로 쥐가 이동할 수 있도록 준비합니다. 이 상태에서 `mouse.onkeydown`로 화살표 키를 핸들링합니다.

문제의 핵심은 `keydown`은 오직 포커스된 요소에서만 트리거 된다는 점입니다. 따라서 원하는 요구사항을 구현하려면 요소에 `tabindex`를 추가해줘야 합니다. 그런데 문제에서 HTML을 수정하지 말라고 했으므로 속성값 추가 말고 `mouse.tabIndex` 프로퍼티를 사용해야 합니다.

참고: 해답에서 `mouse.onclick`을 `mouse.onfocus`로 바꿔도 잘 동작합니다.

[샌드박스를 열어 정답을 확인해보세요.](https://plnkr.co/edit/yxSbp0d8yIP13Ex6?p=preview)
