베지어 곡선
==========

베지어 곡선(Bezier Curve)은 컴퓨터 그래픽스에서 사용되는 특별한 형태의 곡선으로, CSS 애니메이션 등에서 도형을 그릴 때 사용합니다.

곡선 자체는 매우 단순하기 때문에 한 번 공을 들여 공부해 두면 벡터 그래픽스나 고급 애니메이션을 다룰 때 도움이 됩니다.

### 조절점
[베지어 곡선](https://ko.wikipedia.org/wiki/%EB%B2%A0%EC%A7%80%EC%97%90_%EA%B3%A1%EC%84%A0)은 조절점(control point)을 사용해 정의합니다.

조절점의 개수는 2개나 3개, 4개가 될 수 있고 이보다도 많을 수 있습니다.

조절점이 두 개인 베지어 곡선을 살펴봅시다.

![bezier2](../../images/03/05/01/bezier2.svg)

조절점이 세 개인 베지어 곡선은 다음과 같습니다.

![bezier3](../../images/03/05/01/bezier3.svg)

네 개의 조절점이 있을 땐 다음과 같은 곡선이 나옵니다.

![bezier4](../../images/03/05/01/bezier4.svg)

이 곡선들을 주의 깊게 살펴보면, 베지어 곡선은 다음과 같은 특징을 보인다는 걸 알 수 있습니다.
1. **조절점이 항상 곡선 위에 있지는 않습니다.** 이는 아주 자연스러운 현상인데, 아래쪽에서 어떻게 곡선이 만들어지는지 살펴보면 이해할 수 있습니다.
2. 곡선의 차수는 조절점의 개수에서 1을 뺀 값입니다. 조절점이 두 개일 땐 직선, 세 개일 땐 2차 곡선, 네 개일 땐 3차 곡선이 됩니다.
3. 곡선은 항상 조절점의 [컨벡스 헐(convex hull, 볼록 껍질)](https://en.wikipedia.org/wiki/Convex_hull)안에 있습니다.

![bezier3-e](../../images/03/05/01/bezier3-e.svg)
![bezier4-e](../../images/03/05/01/bezier4-e.svg)

마지막 특성 덕분에 컴퓨터 그래픽스 분야에서 교차 검사(intersection test) 최적화가 가능합니다. 컨벡스 헐이 교차하지 않는다면 곡선 역시 교차하지 않기 때문입니다. 따라서 컨벡스 헐이 교차하는지 검사하면 아주 빠르게 곡선 역시 '교차하지 않는다’는 결론을 도출해 낼 수 있습니다. 위쪽 그림에서 보는 것과 같이 컨벡스 헐은 삼각형, 사각형 같은 상대적으로 단순한 형태를 띠므로 곡선의 교차 여부보다 컨벡스 헐 교차 여부를 검사하는 게 훨씬 쉽습니다.

**조절점을 움직이면 베지어 곡선은 직관적으로 봤을 때 아주 당연한 방식으로 다시 그려집니다.**

아래 예시에서 직접 조절점을 움직여봅시다.

![bezier-in-action](../../images/03/05/01/bezier-in-action.png)

예시를 통해 **베지어 곡선이 조절점을 이은 선(1-2, 3-4)을 향해 뻗어나가는 것을 확인할 수 있습니다.**

이런 특징을 염두하고 연습하다 보면 원하는 형태의 곡선을 만들 때 어디에 조절점을 두어야 할지 쉽게 알 수 있습니다.

예시:

![bezier-car](../../images/03/05/01/bezier-car.svg)
![bezier-letter](../../images/03/05/01/bezier-letter.svg)
![bezier-vase](../../images/03/05/01/bezier-vase.svg)

### 카스텔조 알고리즘
베지어 곡선을 정의하는 수학 공식은 나중에 살펴보고, 그 전에 베지어 곡선을 정의하는 공식과 정확히 일치하고 곡선이 만들어지는 과정을 시각화할 때 도움을 주는 [카스텔조 알고리즘(De Casteljau’s algorithm)](https://en.wikipedia.org/wiki/De_Casteljau%27s_algorithm)에 대해 알아봅시다.

먼저 조절점이 3개인 예시를 살펴봅시다.

데모와 설명을 순차적으로 써 두었습니다.

조절점 1, 2, 3을 직접 움직이고 재생 버튼을 눌러 어떻게 곡선이 만들어지는지 확인해 봅시다.

![De-Casteljau’s-algorithm-1](../../images/03/05/01/De-Casteljau’s-algorithm-1.png)

**3점 베지어 곡선을 만드는 카스텔조 알고리즘**은 다음과 같습니다.

1. 조절점을 찍습니다. 데모에선 조절점 각각에 ‘1’, ‘2’, '3’이라는 이름을 붙여주었습니다.
2. 조절점 1과2, 2와 3을 잇는 선분(갈색선)을 만듭니다.
3. 매개변수 't’의 값을 '0’부터 시작해 '1’이 되도록 증가시킵니다. 데모에선 't’가 '0.05’씩 증가해 `0, 0.05, 0.1, 0.15, … 0.95, 1’이 되도록 하였습니다.

    t값을 사용해 다음과 같은 추가 작업을 할 수 있습니다.

- 갈색으로 표시한 각 선분의 시작점에서 t와 비례하는 위치에 점을 찍습니다. 선분이 두 개이기 때문에 점 두 개가 만들어집니다.

  예를 들어 설명하면 다음과 같습니다. t가 0일 땐 두 점이 선분의 시작인 조절점 1과 2에 위치합니다. t가 0.25일 땐 조절점 1에서 조절점 1과 2를 이은 선분의 길이에 25%를 곱한 값만큼 떨어진 곳에 점이 위치합니다. t가 0.5일 땐 선분의 중간, 1일 땐 선분의 끝에 점이 위치합니다.

- 추가작업을 통해 만든 두 점을 연결합니다. 그림에선 파란선에 해당합니다.

|t=0.25|t=0.5|
|---|---|
|![bezier3-draw1](../../images/03/05/01/bezier3-draw1.svg)|![bezier3-draw2](../../images/03/05/01/bezier3-draw2.svg)|

4. 이제 <span style="color: blue">(파란색)</span> 선분에서 t 값과 비례하는 위치에 점 하나를 찍습니다. t가 0.25일 때(왼쪽 그림)는 파란 선분의 4분의 1지점에 빨간점을, t가 0.5일 때(오른쪽 그림)는 선분의 가운데에 빨간점을 찍습니다.

5. t가 0에서 1로 증가하면서 당연히 점도 계속 추가됩니다. 이때 이 점들이 바로 베지어 곡선(빨간색 포물선)을 만듭니다.

지금까진 조절점이 3개인 경우를 살펴보았는데, 조절점이 4개일 때 역시 같은 방식으로 곡선이 만들어집니다.

조절점이 네개 일때 데모를 살펴봅시다.
