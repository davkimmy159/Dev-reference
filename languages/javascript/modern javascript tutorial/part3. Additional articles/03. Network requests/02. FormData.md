[`FormData`](https://xhr.spec.whatwg.org/#interface-formdata) <sub>(객체)</sub>
============================

##### 쉬운 폼 전송 도움 객체
- 파일 · 추가 필드 여부 무관
- HTML 폼 데이터 표현

##### 생성자
```javascript
// HTML 내 form (요소) 존재 시
// - 해당 폼 요소 필드 전체 자동 반영
let formData = new FormData([form]);
```

##### 네트워크 메서드 <sub>(`fetch` 등)</sub> 본문 == `FormData` <sub>(객체)</sub>
- HTTP 메시지 <sub>(브라우저 전송)</sub>
  - 인코딩
- `Content-Type` <sub>(헤더)</sub>
  - `multipart/form-data`

##### `FormData` · 일반 폼 전송
- 서버 관점 차이 X

### 간단한 폼 전송

##### 전송 처리
- 아주 짧은 코드 가능
```html
<form id="formElem">
  <input type="text" name="name" value="Bora">
  <input type="text" name="surname" value="Lee">
  <input type="submit">
</form>

<script>
  formElem.onsubmit = async (e) => {
    e.preventDefault();

    let response = await fetch('/article/formdata/post/user', {
      method: 'POST',
      body: new FormData(formElem)
    });

    let result = await response.json();

    alert(result.message);
  };
</script>
```

![sending-simple-form](../../images/03/03/02/sending-simple-form.png)

##### 서버
- POST 요청 받은 후
  - 응답 <sub>('저장 성공')</sub> 전송

### `FormData` 메서드
- `FormData` 내 필드 수정

##### `append(name, value)`
- `<input name="…" value="…">` <sub>(필드)</sub> 추가
- 동일 `name` <sub>(속성)</sub> 필드 추가 가능

##### `append(name, blob, fileName)`
- `<input name="…" type="file">` <sub>(필드)</sub> 추가
- `fileName` <sub>(3번째 인수)</sub>
  - 해당 파일명 폼 추가
- 동일 `name` <sub>(속성)</sub> 필드 추가 가능

##### `set(name, value)`
- `append` <sub>(메서드)</sub> 동일
- `name` <sub>(속성)</sub> 필드 제거 후 추가
  - 단일 `name` <sub>(속성)</sub> 필드 보장

##### `set(name, blob, fileName)`
- `append` <sub>(메서드)</sub> 동일
- `name` <sub>(속성)</sub> 필드 제거 후 추가
  - 단일 `name` <sub>(속성)</sub> 필드 보장

##### `delete(name)`
- `name` 해당 필드 삭제

##### `get(name)`
- `name` 해당 필드 값 얻기

##### `has(name)`
- `name` 해당 필드 유무 여부

##### 폼 데이터 필드 반복 작업
- `for…of` 사용 가능
```javascript
let formData = new FormData();
formData.append('key1', 'value1');
formData.append('key2', 'value2');

// key · value 리스트
for(let [name, value] of formData) {

  // key1 = value1, key2 = value2
  alert(`${name} = ${value}`);
}
```

### 파일 폼 전송

##### 폼 전송
- `Content-Type` <sub>(속성)</sub>
  - 항상 `multipart/form-data`
- 메시지
  - 인코딩

##### 파일 폼
- 동일
- `<input type="file">` 지정 필드
  - 일반 폼 전송 유사
```html
<form id="formElem">
  <input type="text" name="firstName" value="Bora">
  Picture: <input type="file" name="picture" accept="image/*">
  <input type="submit">
</form>

<script>
  formElem.onsubmit = async (e) => {
    e.preventDefault();

    let response = await fetch('/article/formdata/post/user-avatar', {
      method: 'POST',
      body: new FormData(formElem)
    });

    let result = await response.json();

    alert(result.message);
  };
</script>
```

![sending-file-form](../../images/03/03/02/sending-file-form.png)

### `Blob` 데이터 폼 전송

##### 동적 생성 바이너리 파일 <sub>(이미지 등)</sub>
- 전송 시 `Blob` <sub>(객체)</sub> 사용 가능
  - `fetch` <sub>(메서드)</sub> `body` <sub>(매개변수)</sub> 전달

그런데 실제 코딩을 하다 보면 이미지를 별도로 넘겨주는 것보다 폼에 필드를 추가하고 여기에 이미지 '이름' 등의 메타데이터를 같이 실어 넘겨주는 게 좀 더 편리합니다.

서버 입장에서도 원시 바이너리 데이터를 받는 것보다 multipart-encoded 폼을 받는 게 좀 더 적합하죠.

아래는 `<canvas>`를 사용해 만든 이미지를 `FormData`를 사용해 폼 형태로 다른 추가 필드와 함께 전송하는 예시입니다.
```html
<body style="margin:0">
  <canvas id="canvasElem" width="100" height="80" style="border:1px solid"></canvas>

  <input type="button" value="이미지 전송" onclick="submit()">

  <script>
    canvasElem.onmousemove = function(e) {
      let ctx = canvasElem.getContext('2d');
      ctx.lineTo(e.clientX, e.clientY);
      ctx.stroke();
    };

    async function submit() {
      let imageBlob = await new Promise(resolve => canvasElem.toBlob(resolve, 'image/png'));

      let formData = new FormData();
      formData.append("firstName", "Bora");
      formData.append("image", imageBlob, "image.png");

      let response = await fetch('/article/formdata/post/image-form', {
        method: 'POST',
        body: formData
      });
      let result = await response.json();
      alert(result.message);
    }

  </script>
</body>
```

![sending-blob-data-form](../../images/03/03/02/sending-blob-data-form.png)

예시에서 이미지 `Blob`을 추가한 코드를 다시 봅시다.
```javascript
formData.append("image", imageBlob, "image.png");
```

이 코드는 폼에 `<input type="file" name="image">` 태그가 있고, 사용자 기기의 파일 시스템에서 파일명이 `"image.png"`(3번째 인수 참고)인 `imageBlob` 데이터(2번째 인수 참고)를 추가한 것과 동일한 효과를 줍니다.

요청을 받은 서버는 일반 폼과 동일하게 폼 데이터와 파일을 읽고 처리합니다.

<br />

## 요약
[`FormData`](https://xhr.spec.whatwg.org/#interface-formdata) 객체는 `fetch` 등의 네트워크 메서드를 통해 HTML 폼을 보내는데 사용됩니다.

`FormData` 객체는 HTML 폼(`form`)을 직접 넘겨 `new FormData(form)`으로 만들 수도 있고, HTML 폼 없이 다음과 같은 메서드로 필드를 추가해 만들 수도 있습니다.
- `formData.append(name, value)`
- `formData.append(name, blob, fileName)`
- `formData.set(name, value)`
- `formData.set(name, blob, fileName)`

메서드를 사용할 때 주의할 점 2가지가 있습니다.
1. `set` 메서드는 `name`이 같은 필드 모두를 지우고 `append`는 그렇지 않습니다. 다른 차이는 없습니다.
2. 파일을 보낼 땐 세 번째 인수가 필요한데 이 인수는 사용자 파일 시스템에서 지정한 파일명과 동일하게 지정됩니다.

이 외에도 다음과 같은 메서드가 있습니다
- `formData.delete(name)`
- `formData.get(name)`
- `formData.has(name)`
