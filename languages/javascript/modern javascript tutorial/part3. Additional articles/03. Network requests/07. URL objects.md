`URL` <sub>(객체)</sub>
===========

##### [`URL`](https://url.spec.whatwg.org/#api) <sub>(내장 클래스)</sub>
- 편의 인터페이스 제공
  - URL 생성 · 파싱 등

##### 대다수 네트워크 메서드
- `URL` <sub>(객체)</sub> 필요 X
- url 문자열 요구

### URL 생성

##### `URL` <sub>(객체)</sub> 생성 문법
```javascript
new URL(url, [base]);
```
##### `url`
- 전체 url
- 일부 경로
  - `base` <sub>(2번째 인수)</sub> 필요

##### `base` <sub>(optional)</sub>
- 기본 url
  - `url` <sub>(1번째 인수 · 일부 경로)</sub> 기준
```javascript
let url = new URL('https://javascript.info/profile/admin');
```
```javascript
// 두 url 동일
let url1 = new URL('https://javascript.info/profile/admin');
let url2 = new URL('/profile/admin', 'https://javascript.info');

alert(url1); // https://javascript.info/profile/admin
alert(url2); // https://javascript.info/profile/admin
```

##### 기존 url 이용해 새 url 쉽게 생성
```javascript
let url = new URL('https://javascript.info/profile/admin');
let newUrl = new URL('tester', url);

// https://javascript.info/profile/tester
alert(newUrl);
```

##### `URL` <sub>(객체)</sub> 내 url 컴포넌트 접근 가능
- url 파싱 유용
```javascript
let url = new URL('https://javascript.info/url');

alert(url.protocol); // https:
alert(url.host);     // javascript.info
alert(url.pathname); // /url
```

#### url 컴포넌트

![url-object](../../images/03/03/07/url-object.svg)

##### `href`
- 전체 url
- `url.toString()` 동일

##### `protocol`
- 끝 부분 `:` <sub>(콜론)</sub>

##### `search`
- 매개변수 문자열
- 첫 부분 `?` <sub>(물음표)</sub>

##### `hash`
- 첫 부분 `#` <sub>(해쉬 글자)</sub>

##### `user` · `password` <sub>(프로퍼티)</sub>
- HTTP 인증 설정 시 有
  - `http://login:password@site.com`

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **문자열 대신 `URL` <sub>(객체)</sub> 가능**

##### url 문자열 → `URL` <sub>(객체)</sub>
- 거의 모든 경우 대체 사용 가능
  - `fetch` <sub>(메서드)</sub>
  - `XMLHttpRequest` <sub>(객체)</sub>
  - 기타 등등

##### `URL` <sub>(객체)</sub> 전달 시
- 문자열 변환 수행
  - 전체 url

<br />

### `searchParams` <sub>(프로퍼티 · `?…`)</sub>

##### url 문자열 내 검색 매개변수 포함
```javascript
new URL('https://google.com/search?query=JavaScript')
```

##### 매개변수 인코딩
- 공백
- 非라틴 글자
- 기타 등등

##### `searchParams` <sub>(프로퍼티)</sub>
- [`URLSearchParams`](https://url.spec.whatwg.org/#urlsearchparams) <sub>(객체)</sub>
- 이터러블 <sub>(객체)</sub>
- `Map` 유사

#### 메서드

##### `append(name, value)`
- `name` <sub>(매개변수)</sub> 추가

##### `delete(name)`
- `name` <sub>(매개변수)</sub> 삭제

##### `get(name)`
- `name` <sub>(매개변수)</sub> 얻기

##### `getAll(name)`
- 모든 `name` <sub>(매개변수)</sub> 얻기
  - ex\) `?user=John&user=Pete`

##### `has(name)`
- `name` <sub>(매개변수)</sub> 존재 여부

##### `set(name, value)`
- `name` <sub>(매개변수)</sub> 생성 · 교체

##### `sort()`
- 매개변수명 기준 정렬
- 드물게 사용

##### 매개변수 <sub>(공백 · 구두점)</sub>
```javascript
let url = new URL('https://google.com/search');

url.searchParams.set('q', 'test me!'); // added parameter with a space and !

alert(url); // https://google.com/search?q=test+me%21

url.searchParams.set('tbs', 'qdr:y'); // added parameter with a colon :

// parameters are automatically encoded
alert(url); // https://google.com/search?q=test+me%21&tbs=qdr%3Ay

// iterate over search parameters (decoded)
for(let [name, value] of url.searchParams) {
  alert(`${name}=${value}`); // q=test me!, then tbs=qdr:y
}
```

### Encoding
There's a standard [RFC3986](https://datatracker.ietf.org/doc/html/rfc3986) that defines which characters are allowed in URLs and which are not.

Those that are not allowed, must be encoded, for instance non-latin letters and spaces – replaced with their UTF-8 codes, prefixed by `%`, such as `%20` (a space can be encoded by `+`, for historical reasons, but that's an exception).

The good news is that `URL` objects handle all that automatically. We just supply all parameters unencoded, and then convert the `URL` to string:
```javascript
// using some cyrillic characters for this example

let url = new URL('https://ru.wikipedia.org/wiki/Тест');

url.searchParams.set('key', 'ъ');
alert(url); //https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D1%81%D1%82?key=%D1%8A
```

As you can see, both `Тест` in the url path and `ъ` in the parameter are encoded.

The URL became longer, because each cyrillic letter is represented with two bytes in UTF-8, so there are two `%..` entities.

#### Encoding strings
In old times, before `URL` objects appeared, people used strings for URLs.

As of now, `URL` objects are often more convenient, but strings can still be used as well. In many cases using a string makes the code shorter.

If we use a string though, we need to encode/decode special characters manually.

There are built-in functions for that:
- [`encodeURI`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI) – encodes URL as a whole.
- [`decodeURI`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURI) – decodes it back.
- [`encodeURIComponent`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent) – encodes a URL component, such as a search parameter, or a hash, or a pathname.
- [`decodeURIComponent`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURIComponent) – decodes it back.

A natural question is: "What's the difference between `encodeURIComponent` and `encodeURI`? When we should use either?"

That's easy to understand if we look at the URL, that's split into components in the picture above:
```javascript
https://site.com:8080/path/page?p1=v1&p2=v2#hash
```

As we can see, characters such as `:`, `?`, `=`, `&`, `#` are allowed in URL.

…On the other hand, if we look at a single URL component, such as a search parameter, these characters must be encoded, not to break the formatting.
- `encodeURI` encodes only characters that are totally forbidden in URL.
- `encodeURIComponent` encodes same characters, and, in addition to them, characters `#`, `$`, `&`, `+`, `,`, `/`, `:`, `;`, `=`, `?` and `@`.

So, for a whole URL we can use `encodeURI`:
```javascript
// using cyrillic characters in url path
let url = encodeURI('http://site.com/привет');

alert(url); // http://site.com/%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82
```

…While for URL parameters we should use `encodeURIComponent` instead:
```javascript
let music = encodeURIComponent('Rock&Roll');

let url = `https://google.com/search?q=${music}`;
alert(url); // https://google.com/search?q=Rock%26Roll
```

Compare it with `encodeURI`:
```javascript
let music = encodeURI('Rock&Roll');

let url = `https://google.com/search?q=${music}`;
alert(url); // https://google.com/search?q=Rock&Roll
```

As we can see, `encodeURI` does not encode `&`, as this is a legit character in URL as a whole.

But we should encode `&` inside a search parameter, otherwise, we get `q=Rock&Roll` – that is actually `q=Rock` plus some obscure parameter `Roll`. Not as intended.

So we should use only `encodeURIComponent` for each search parameter, to correctly insert it in the URL string. The safest is to encode both name and value, unless we're absolutely sure that it has only allowed characters.

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **Encoding difference compared to `URL`**

Classes [`URL`](https://url.spec.whatwg.org/#url-class) and [`URLSearchParams`](https://url.spec.whatwg.org/#interface-urlsearchparams) are based on the latest URI specification: [RFC3986](https://datatracker.ietf.org/doc/html/rfc3986), while `encode[*]` functions are based on the obsolete version [RFC2396](https://www.ietf.org/rfc/rfc2396.txt).

There are few differences, e.g. IPv6 addresses are encoded differently:
```javascript
// valid url with IPv6 address
let url = 'http://[2607:f8b0:4005:802::1007]/';

alert(encodeURI(url)); // http://%5B2607:f8b0:4005:802::1007%5D/
alert(new URL(url)); // http://[2607:f8b0:4005:802::1007]/
```

As we can see, `encodeURI` replaced square brackets `[...]`, that's not correct, the reason is: IPv6 urls did not exist at the time of RFC2396 (August 1998).

Such cases are rare, `encode[*]` functions work well most of the time.
