객체 → 원시형 변환
====

##### 객체 → `boolean` 형 변환
- 논리 평가 시 발생
  - 항상 `true` 반환

##### 객체 → `number` 형 변환
- 객체 간 연산 · 수학 관련 함수 적용 시 발생
- ex\) `Date` <sub>(내장 객체)</sub> 간 차감 <sub>(`date1 - date2`)</sub>
  - 두 일시 시간 차 반환

##### 객체 → `string` 형 변환
- 보통 객체 출력 시 발생
  - ex\) `alert(obj)`

### 변환 규칙

##### 기능
- 형 변환 조정
  - 객체 → `number` · `string`

##### 객체 형 변환 종류 <sub>(3가지)</sub> 구분 기준
- 'hint' 값 <sub>(목표 자료형)</sub>
  - `"string"`
  - `"number"`
  - `"default"`

#### `"string"`

##### 문자열 기대 연산 수행 <sub>(객체 → `string`)</sub> 시 'hint' 값
- ex\) `alert` <sub>(함수)</sub>
```javascript
alert(obj);      // 객체 출력

some[obj] = 123; // 객체형 프로퍼티 키 설정
```

#### `"number"`

##### 수학 연산 적용 <sub>(객체 → `number`)</sub> 시 'hint' 값
```javascript
let num = Number(obj); // 명시적 형 변환

/* 수학 연산 (`+` 이항 덧셈 연산 외) */
let n = +obj; // `+` (단항 덧셈 연산)
let delta = date1 - date2;

// 크기 비교
let greater = user1 > user2;
```

#### `"default"`

##### 연산자 기대 자료형 불확실 <sub>(드물게 발생)</sub> 시 'hint' 값
- ex\) `+` <sub>(이항 덧셈 연산자)</sub>
  - 2가지 자료형 피연산자 가능
    - `string` <sub>(문자열 결합)</sub>
    - `number` <sub>(숫자 덧셈)</sub>
- ex\) `==` <sub>(동등 연산자)</sub>
  - 비교 시 피연산자 자동 형 변환
    - 객체 형 변환 자료형 불확실
```javascript
// `+` (이항 덧셈 연산)
let total = obj1 + obj2;

// `==` (동등 연산)
if (user == 1) { … };
```

##### `<` · `>` <sub>(비교 연산자)</sub>
- 2가지 자료형 피연산자 가능
  - `string`
  - `number`
- `"number"` <sub>('hint' 값)</sub> 고정
  - 하위 호환성

##### `Date` 외 모든 내장 객체
- `"number"` == `"default"` <sub>('hint' 값)</sub>
  - 동일 처리

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **`"boolean"` <sub>('hint' 값)</sub> 無**

##### 모든 객체 논리 평가 시
- 항상 `true` 반환

##### `"number"` == `"default"` <sub>('hint' 값)</sub>
- 동일 처리 <sub>(`Date` 내장 객체 제외)</sub>

##### 사실상 형 변환 종류 <sub>(2가지)</sub>
- `"string"`
- `"number"`

#### 객체 형 변환 알고리즘

##### 1. `[Symbol.toPrimitive](hint)` <sub>(메서드)</sub>
- 객체 내 존재 시 호출 · 종료
- `Symbol.toPrimitive`
  - 시스템 `symbol`

##### 2. ① 미해당 · `"string"` <sub>('hint' 값)</sub>
1. `toString` <sub>(메서드)</sub> 존재 시 호출 · 종료
2. `valueOf` <sub>(메서드)</sub> 존재 시 호출 · 종료

##### 3. ① · ② 미해당 · `"number"` · `"default"` <sub>('hint' 값)</sub>
1. `valueOf` <sub>(메서드)</sub> 존재 시 호출 · 종료
2. `toString` <sub>(메서드)</sub> 존재 시 호출 · 종료

### [`[Symbol.toPrimitive]`](https://tc39.github.io/ecma262/#sec-toprimitive) <sub>(특수 메서드)</sub>
- hint <sub>(목표 자료형)</sub> 명명
```javascript
obj[Symbol.toPrimitive] = function(hint) {

  /*
   원시값 반환 필수
   hint (인수) : 3가지 중 하나
  - 'string'
  - 'number'
  - 'default'
  */

};
```

##### 메서드 하나로 모든 종류 형 변환 가능
```javascript
let user = {
  name: "John",
  money: 1000,

  [Symbol.toPrimitive](hint) {
    alert(`hint: ${hint}`);
    if (hint == 'string') {
      return `{name: "${this.name}"}`;
    } else {
      return this.money;
    }
  }
};

// hint: 'string'
// - { name: "John" }
alert(user);

// hint: 'number'
// - 1000
alert(+user);

// hint: 'default'
// - 1500
alert(user + 500);
```

#### `toString` · `valueOf` <sub>(메서드)</sub>
- '평범한' 메서드
- 구식 형 변환 메서드

##### 객체 내 `[Symbol.toPrimitive]` <sub>(메서드)</sub> 부재 시
- hint : 'string'
  - `toString` → `valueOf` 순 호출
- hint : 'number' · 'default'
  - `valueOf` → `toString` 순 호출
- 원시값 반환 필수
  - 객체 반환 시 결과 무시

#### 기본 규칙 <sub>(일반 객체)</sub>

##### `toString` <sub>(메서드)</sub>
- `"[object Object]"` <sub>(문자열)</sub> 반환

##### `valueOf` <sub>(메서드)</sub>
- 객체 자신 반환 <sub>(결과 무시)</sub>
  - 역사적 이유
  - 없는 거나 마찬가지
```javascript
let user = { name: "John" };

// [object Object]
alert(user);

// true
alert(user.valueOf() === user);
```

##### 예제 동일 기능 구현
- `[Symbol.toPrimitive]` 예제
```javascript
let user = {
  name: "John",
  money: 1000,

  // hint : 'string'
  toString() {
    return `{name: "${this.name}"}`;
  },

  // hint : 'number' · 'default'
  valueOf() {
    return this.money;
  }

};

// toString
// - { name: "John" }
alert(user);

// valueOf
// - 1000
alert(+user);

// valueOf
// - 1500
alert(user + 500);
```

##### `[Symbol.toPrimitive]` · `valueOf` 부재 시
- `toString`
  - 모든 형 변환 처리
- 한 곳에서 모든 형 변환 처리 필요 시
  - `toString` 만 구현
```javascript
let user = {
  name: "John",

  toString() {
    return this.name;
  }
};

// toString
// - John
alert(user);

// toString
// - John500
alert(user + 500);
```

### 반환 타입

##### hint 명시 자료형으로 형 변환 보장 X
- `toString()`
  - 항상 문자열 반환 보장 X
- `[Symbol.toPrimitive]('number')`
  - 항상 `number` 반환 보장 X

##### 확실한 사실
- 객체 아닌 원시값 반환

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **과거의 잔재**

##### `toString` · `valueOf` <sub>(메서드)</sub>
- 객체 반환 시
  - 에러 X
  - 반환 값 무시
  - 메서드 존재하지 않았던 것처럼 동작

##### 과거 JS
- 에러 개념 정립 부족

##### `[Symbol.toPrimitive]` <sub>(메서드)</sub>
- 원시 자료 반환 필수
- 미반환 시 에러

<br />

### 추가 형 변환

##### 상당수 연산자 · 함수
- 피연산자 형 변환 실행
- 객체 피연산자
  1. 객체 → 원시형 형 변환
  2. 변환 후 원시값 : 원하는 형 아닐 시
      - 다시 형 변환
```javascript
let obj = {

  // 다른 형 변환 메서드 부재 시
  // - toString : 모든 형 변환 처리
  toString() {
    return "2";
  }
};

alert(obj * 2); // 4
alert(obj + 2); // 22
```

##### `alert(obj * 2)` <sub>(`4`)</sub>

|obj <sub>("2")</sub>|2|곱셈 연산|4|
|:---:|:---:|:---:|:---:|
|객체 <sub>(문자열)</sub>|숫자|문자열 * 숫자|숫자|

##### `alert(obj + 2)` <sub>(`22`)</sub>

|obj <sub>("2")</sub>|2|이항 덧셈 연산|"22"|
|:---:|:---:|:---:|:---:|
|객체 <sub>(문자열)</sub>|숫자|문자열 + 숫자|문자열|

<br />

요약
====

##### 원시값 기대 내장 함수 · 연산자 사용 시
- 객체 → 원시형 자동 형 변환

#### 형 변환 3종류 <sub>(hint 기준)</sub>

##### `"string"`
- 문자열 필요 연산 <sub>(`alert` 등)</sub>

##### `"number"`
- 수학 연산

##### `"default"`
- 연산자 기대 피연산자 확신 X
  - 드물게 발생
- 내장 객체
  - `"number"` 동일 처리
- 실무
  - `"number"` · `"default"` 합쳐서 처리

##### 연산자별 적용 hint
- 명세서 참조

#### 객체 → 원시형 형 변환 알고리즘

##### 1. 객체 내 `[Symbol.toPrimitive](hint)` <sub>(메서드)</sub> 확인
- 구현 시 호출

##### 2. ① 미해당 · hint == `"string"`
1. `toString` <sub>(메서드)</sub> 호출
2. `valueOf` <sub>(메서드)</sub> 호출
    - `toString` <sub>(메서드)</sub> 부재 시

##### 3. ① · ② 미해당 · hint == `"number"` · `"default"`
1. `valueOf` <sub>(메서드)</sub> 호출
2. `toString` <sub>(메서드)</sub> 호출
    - `valueOf` <sub>(메서드)</sub> 부재 시

##### `toString` <sub>(메서드)</sub>
- 모든 형 변환 다 처리 가능
- 실무
  - 모든 형 변환 처리 메서드로 주로 사용
- 반환 값
  - '사람이 읽고 이해할 수 있는' 형식
    - 실용성 ↑
- 로깅 · 디버깅 목적
  - 자주 사용
