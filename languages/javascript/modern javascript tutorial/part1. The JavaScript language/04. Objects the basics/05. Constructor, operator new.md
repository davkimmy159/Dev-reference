`new` <sub>(연산자)</sub> · 생성자 함수
======================

- 유사 객체 여러 개 생성 시 유용

### 생성자 함수

##### 생성자 · 일반 함수
- 기술적 차이 X

##### 관례
- 함수 이름 첫 글자
  - 대문자
- 반드시 `new` <sub>(연산자)</sub> 붙여 실행

##### 생성자 함수 실행 알고리즘
1. 빈 객체 생성 후 `this` 할당
2. 함수 본문 실행
    - `this` 에 새 프로퍼티 추가 <sub>(`this` 수정)</sub>
3. `this` 반환
```javascript
function User(name) {
  this.name = name;
  this.isAdmin = false;
}

↓↓↓

function User(name) {

  // 빈 객체 암시적으로 생성
  // this = {};

  // 새 프로퍼티 this 에 추가
  this.name = name;
  this.isAdmin = false;

  // this 암시적으로 반환
  // return this;
}

let user = new User("보라");

↓↓↓

let user = {
  name: "보라",
  isAdmin: false
};

alert(user.name);    // 보라
alert(user.isAdmin); // false
```
- 재사용 객체 생성 코드
```javascript
let user 1 = new User("호진");
let user 2 = new User("지민");
```
- 모든 함수 : 생성자 함수 일 수 있음
  - 기술적 차이 X
- `new` 붙여 실행 시
  - 생성자 함수 알고리즘 실행
- 첫 글자 대문자 함수
  - 반드시 `new` 붙여 실행

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **`new function() { … }`**

##### 익명 생성자
- 재사용 필요 없는 복잡한 객체에 사용
- 익명 함수 <sub>(어디에도 저장 X)</sub>
- 단 한 번만 호출 <sub>(재사용 불가능)</sub>
- 코드 캡슐화
```javascript
 // 익명 생성자 함수
let user = new function() {
  this.name = "John";
  this.isAdmin = false;
  …
};
```

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **심화 학습**

### `new.target` 과 생성자 함수

##### `new.target` <sub>(프로퍼티)</sub>
- 함수 · `new` 함께 호출 여부 확인
- 일반적인 함수 호출 시
  - `undefined` 반환
- `new` 함께 함수 호출 시
  - 함수 자체 반환
```javascript
function User() {
  alert(new.target);
}

// 'new' 없이 호출 (일반적인 호출)
User();     // undefined

// 'new' 붙여 호출 (생성자 호출)
new User(); // function User { … }
```
- 일반적인 호출 · `new` 함께 호출
  - 동일 동작 트릭
```javascript
function User(name) {
  if (!new.target) {       // new 없이 호출 시
    return new User(name); // new 추가
  }
  this.name = name;
}

let bora = User("보라");   // == new User("보라")
alert(bora.name);         // 보라
```
- `new` 유무 상관 X <sub>(동일 동작)</sub>
  - 좀 더 유연하게 코드 작성
- `new` 함께 호출 시
  - 새 객체 생성 동작 누구나 알 수 있음
- `new` 없는 객체 생성 남발 X

### 생성자와 `return`

##### 생성자 내 `return`
- 객체 반환 시
  - `this` 대신 객체 반환
- 원시형 반환 시
  - 무시 · `this` 반환
```javascript
function BigUser() {
  this.name = "원숭이";
  return { name: "고릴라" };     // this 반환 X
                                // 새 객체 반환
}
alert( new BigUser().name );   // 고릴라

function SmallUser() {
  this.name = "원숭이";
  return;                      // 무시 · this 반환
}
alert( new SmallUser().name ); // 원숭이
```
- `return` 있는 생성자 함수
  - 거의 없음

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **괄호 생략하기**

##### 인수 없는 생성자
- 괄호 없이 호출 가능
  - 명세서 내 정의
  - 좋은 코딩 스타일 X
```javascript
let user1 = new User;   // 호출 시 괄호 X
let user2 = new User();
```

<br />

### 생성자 내 메서드
- 매개변수 이용해 객체 내부 자유롭게 구성
  - 엄청난 유연성 확보
- `this` 에 메서드 추가
```javascript
function User(name) {
  this.name = name;
  this.sayHi = function() {
    alert( "제 이름은 " + this.name + "입니다." );
  };
}

let bora1 = new User("이보라");
bora1.sayHi(); // 제 이름은 이보라입니다.

// 객체 리터럴
bora2 = {
   name: "이보라",
   sayHi: function() { … }
}
```

<br />

## 요약

##### 생성자 함수 <sub>(생성자)</sub>
- 일반 함수
- 함수명 첫 글자 : 대문자
  - 일반 함수와 구분
- 반드시 `new` <sub>(연산자)</sub> 함께 호출
  - 내부 `this` 암시적 생성
  - 마지막 `this` 반환

생성자 함수는 유사한 객체를 여러 개 만들 때 유용합니다.

자바스크립트는 언어 차원에서 다양한 생성자 함수를 제공합니다. 날짜를 나타내는 데 쓰이는 `Date`, 집합(set)을 나타내는 데 쓰이는 `Set` 등의 내장 객체는 이런 생성자 함수를 이용해 만들 수 있습니다. 자세한 내용은 다시 살펴보도록 하겠습니다.

<br />

## <img src="../../images/commons/icons/circle-check-solid.svg" /> 과제

### 함수 두 개로 동일한 객체 만들기
`new A()==new B()`가 성립 가능한 함수 `A`와 `B`를 만드는 게 가능할까요?
```javascript
function A() { ... }
function B() { ... }

let a = new A;
let b = new B;

alert( a == b ); // true
```

만약 가능하다면, 실행 가능한 예시를 작성해 보세요.

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

네, 가능합니다.

두 함수 모두 `this` 대신에 객체를 반환하게 하면 됩니다.

아래 예시에선 함수 외부에서 정의한 객체 `obj`를 반환하도록 했습니다.
```javascript
let obj = {};

function A() { return obj; }
function B() { return obj; }

alert( new A() == new B() ); // true
```

<hr />

### 계산기 만들기
아래와 같은 세 개의 메서드를 가진 생성자 함수, `Calculator`를 만들어보세요.
- `read()` – `prompt` 함수를 이용해 사용자로부터 값 두 개를 받고, 이를 객체 프로퍼티에 저장합니다.
- `sum()` – 프로퍼티에 저장된 값 두 개를 더한 후 반환합니다.
- `mul()` – 프로퍼티에 저장된 값 두 개를 곱한 후 반환합니다.

예시:
```javascript
let calculator = new Calculator();
calculator.read();

alert( "Sum=" + calculator.sum() );
alert( "Mul=" + calculator.mul() );
```

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

```javascript
function Calculator() {

  this.read = function() {
    this.a = +prompt('a?', 0);
    this.b = +prompt('b?', 0);
  };

  this.sum = function() {
    return this.a + this.b;
  };

  this.mul = function() {
    return this.a * this.b;
  };
}

let calculator = new Calculator();
calculator.read();

alert( "Sum=" + calculator.sum() );
alert( "Mul=" + calculator.mul() );
```

[정답](https://plnkr.co/edit/tGcIZnNXJZdRbb2M?p=preview)

<hr />

### 누산기 만들기
생성자 함수 `Accumulator(startingValue)`를 만들어 보세요.

`Accumulator(startingValue)`를 이용해 만드는 객체는 아래와 같은 요건을 충족해야 합니다.

- 프로퍼티 `value`에 현재 값(current value)을 저장합니다. 최초 호출 시엔 생성자 함수의 인수, `startingValue`에서 시작값(starting value)을 받아옵니다.
- 메서드 `read()`에선 `prompt` 함수를 사용해 사용자로부터 숫자를 받아오고, 받은 숫자를 `value`에 더해줍니다.

프로퍼티 `value`엔 `startingValue`와 사용자가 입력한 모든 값의 총합이 더해져 저장됩니다.

데모를 위한 코드는 다음과 같습니다.
```javascript
let accumulator = new Accumulator(1); // 최초값: 1

accumulator.read(); // 사용자가 입력한 값을 더해줌
accumulator.read(); // 사용자가 입력한 값을 더해줌

alert(accumulator.value); // 최초값과 사용자가 입력한 모든 값을 더해 출력함
```

<br />

<img src="../../images/commons/icons/circle-answer.svg" />

```javascript
function Accumulator(startingValue) {
  this.value = startingValue;

  this.read = function() {
    this.value += +prompt('더할 값을 입력해주세요.', 0);
  };

}

let accumulator = new Accumulator(1);
accumulator.read();
accumulator.read();
alert(accumulator.value);
```

[정답](https://plnkr.co/edit/7CU6wBh2Q1plFL0A?p=preview)
