프로퍼티 플래그 · 설명자
====

### 프로퍼티 플래그

##### 플래그 속성 <sub>(3가지)</sub>

|플래그|허용 여부 설정|
|:---:|:---:|
|`writable`|값 수정|
|`enurable`|반복문 나열|
|`configurable`|프로퍼티 삭제|
||플래그 수정|

##### [`Object.getOwnPropertyDescriptor`](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor) <sub>(메서드)</sub>
```javascript
let descriptor = Object.getOwnPropertyDescriptor(obj, propertyName);
```
- 특정 프로퍼티 정보 반환
- `obj`
  - 대상 객체
- `propertyName` <sub>(문자열)</sub>
  - 대상 객체 내 프로퍼티명
- 반환 값
  - 프로퍼티 설명자 <sub>(객체)</sub>
    - 프로퍼티 값
    - 플래그 정보 <sub>(3가지)</sub>
```javascript
let user = {
  name: "John"
};

let descriptor = Object.getOwnPropertyDescriptor(user, 'name');

JSON.stringify(descriptor, null, 2);
/* 프로퍼티 설명자 (반환 객체)
{
  "value": "John",
  "writable": true,
  "enumerable": true,
  "configurable": true
}
 */
```

##### [`Object.defineProperty`](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty) <sub>(메서드)</sub>
```javascript
Object.defineProperty(obj, propertyName, descriptor)
```
- 플래그 변경
- `obj`
  - 대상 객체
- `propertyName` <sub>(문자열)</sub>
  - 대상 객체 내 프로퍼티명
- `descriptor` <sub>(객체)</sub>
  - 프로퍼티 설명자 <sub>(변경 값)</sub>

##### 대상 객체 내 해당 프로퍼티 유무 여부
- 有 → 플래그 변경
- 無 → 새 프로퍼티 생성
  - 프로퍼티 설명자 <sub>(인수)</sub> 사용
  - `false` <sub>(기본값)</sub>
```javascript
let user = {};

Object.defineProperty(user, "name", {
  value: "John"
});

let descriptor = Object.getOwnPropertyDescriptor(user, 'name');

JSON.stringify(descriptor, null, 2);
/*
{
  "value": "John",
  "writable": false,
  "enumerable": false,
  "configurable": false
}
 */
```

#### 일반 문법 vs `defineProperty` <sub>(메서드)</sub>

##### 플래그 기본값 차이
- 일반 프로퍼티 정의
  - `true`
- `defineProperty` <sub>(메서드)</sub>
  - `false`

### `writable` 플래그

##### 값 수정 허용 여부 설정
- `false`
  - 수정 불허 <sub>(읽기만 가능)</sub>
```javascript
let user = {
  name: "John"
};

Object.defineProperty(user, "name", {
  writable: false
});

// 프로퍼티 값 수정 시 에러
user.name = "Pete"; // Error: Cannot assign to read only property 'name'
```

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **엄격 vs 非엄격 모드 <sub>(플래그 규칙 위반)</sub>**

##### 플래그 규칙 위반 <sub>(읽기 전용 프로퍼티 수정 등)</sub> 시 결과 상이
- 엄격 모드
  - 에러
- 非엄격 모드
  - 에러 X <sub>(무시)</sub>

<br />

##### `Object.defineProperty` <sub>(메서드)</sub>
- 새 프로퍼티 생성 가능
  - 값 할당
  - 플래그 설정
```javascript
let user = {
  name: "John"
};

Object.defineProperty(user, "name", {
  writable: false
});

↓↓↓

let user = {};

Object.defineProperty(user, "name", {
  value: "John",

  // 플래그 설정
  // - true 만 명시
  // - false 생략 (기본값)
//writable: false,
  enumerable: true,
  configurable: true,
});
```

### `enumerable` 플래그

##### 열거 허용 여부 설정
- `false`
  - 반복 순회 시 배제
    - `for…in`
    - `Object.keys`
```javascript
let user = {
  name: "John",
  age: 25
};

Object.defineProperty(user, "age", {
  enumerable: false
});

for (let key in user) {
  alert(key); // name
}

Object.keys(user); // name
```

##### `toString` <sub>(메서드)</sub>
- `Object.toString` <sub>(내장 메서드)</sub>
  - 열거 불허 프로퍼티
    - 반복 순회 시 배제
- `toString` <sub>(커스텀 메서드)</sub>
  - 열거 가능 프로퍼티 <sub>(기본값)</sub>
    - 반복 순회 시 포함
  - 열거 불허 설정 시 반복 순회 배제
```javascript
let user = {
  name: "John"
};

for (let key in user) {
  alert(key); // name
}

// 커스텀 toString (메서드) 추가
user.toString = function() {
  return this.name;
};

for (let key in user) {
  alert(key); // name, toString
}

// 열거 불허 설정
Object.defineProperty(user, "toString", {
  enumerable: false
});

for (let key in user) {
  alert(key); // name
}
```

### `configurable` 플래그

##### 프로퍼티 삭제 · 플래그 변경 허용 여부 설정
- `false` <sub>(일부 내장 객체 · 프로퍼티 기본값)</sub>
  - 프로퍼티 삭제 불허
  - 플래그 변경 불허

##### `Math.PI` <sub>(내장 객체 내 프로퍼티)</sub>
- 쓰기 불허 <sub>(수정 불가능)</sub>
- 열거 불허 <sub>(반복 순회 시 배제)</sub>
- 구성 불허 <sub>(삭제 · 플래그 변경 불가능)</sub>
```javascript
let descriptor = Object.getOwnPropertyDescriptor(Math, 'PI');

JSON.stringify(descriptor, null, 2);
/*
{
  "value": 3.141592653589793,
  "writable": false,
  "enumerable": false,
  "configurable": false
}
 */

Math.PI = 3; // Error
```

##### `configurable: false` 설정
- 취소 <sub>(`true` 설정)</sub> 불가능
- `defineProperty` 소용 X

##### 구체적 제약사항

||동작||
|---|:---:|:---:|
|`writable`|`false` → `true`|X|
||`true` → `false`|O|
|`enumerable`|플래그 수정|X|
|`configurable`|플래그 수정|X|
|`get` · `set`<br /><sub>(접근자 프로퍼티)</sub>|변경|X|
||생성|O|

##### '영원히 변경할 수 없는' 프로퍼티
```javascript
let user = {};

Object.defineProperty(user, "name", {
  value: "John",
  writable: false,
  configurable: false
});

// user.name (프로퍼티)
// - 값 · 플래그 변경 X
// - 변경 시 에러
user.name = "Pete"; // Error
delete user.name ;  // Error

// Error
Object.defineProperty(user, "name", {value: "Pete"});

// Error
Object.defineProperty(user, "name", {writable: true});
```

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **'non-writable' vs 'non-configurable'**

##### `{writable: true, configurable: false}`
- 플래그 값 변경 X
- 프로퍼티 삭제 X
- 프로퍼티 값 변경 O

<br />

### `Object.defineProperties`

##### 한 번에 다수 프로퍼티 정의
```javascript
Object.defineProperties(obj, {
  prop1: descriptor1,
  prop2: descriptor2
  …
});
```
```javascript
Object.defineProperties(user, {
  name:    {value: "John",  writable: false},
  surname: {value: "Smith", writable: false},
  …
});
```

### `Object.getOwnPropertyDescriptors`

##### 모든 프로퍼티 설명자 한 번에 가져옴
- `symbol` 프로퍼티 포함

##### `Object.defineProperties` 함께 사용 시
- 객체 · 플래그 함께 복사
```javascript
let clone = Object.defineProperties({}, Object.getOwnPropertyDescriptors(obj));
```

##### `=` <sub>(할당 연산자)</sub>
- 플래그 복사 X

##### `for…in` <sub>(반복문)</sub>
- `symbol` 프로퍼티 배제
```javascript
// symbol 프로퍼티 배제
for (let key in user) {

  // 플래그 복사 X
  clone[key] = user[key];
}
```

### 객체 수정 막는 다양한 메서드
- 실무
  - 드물게 사용

##### 한 객체 내 전체 프로퍼티 대상 설정

|메서드|추가|삭제|수정|전체 프로퍼티|
|---|:---:|:---:|:---:|---|
|`Object.preventExtensions(obj)`|X|O|O||
|`Object.seal(obj)`|X|X|O|`configurable: false`|
|`Object.freeze(obj)`|X|X|X|`writable: false`<br />`configurable: false`|

#### 제약사항 확인

##### `Object.isExtensible(obj)`
- 프로퍼티 추가 가능 여부

##### `Object.isSealed(obj)`
- 프로퍼티 추가 · 삭제 불가능 여부
- 전체 프로퍼티 설정 여부
  - `configurable: false`

##### `Object.isFrozen(obj)`
- 프로퍼티 추가 · 삭제 · 변경 불가능 여부
- 전체 프로퍼티 설정 여부
  - `writable: false`
  - `configurable: false`
