이터러블 <sub>(객체)</sub>
====

##### 배열 일반화 객체
- `for…of` <sub>(반복문)</sub> 적용 가능
  - 배열
  - 문자열
  - 다수 내장 객체

##### 컬렉션 <sub>(목록 · 집합 등)</sub> 객체 <sub>(배열 X)</sub>
- `for…of` 문법 적용 시
  - 컬렉션 순회 유용

### `[Symbol.iterator]` <sub>(메서드)</sub>

##### 이터러블 객체화 담당 메서드
- `for…of` <sub>(반복문)</sub> 사용 가능

#### `for…of` <sub>(반복문)</sub> 진행 과정

##### 1. 최초 시작
- `[Symbol.iterator]` <sub>(메서드)</sub> 호출
  - 메서드 부재 시 에러
  - iterator <sub>(`next` 메서드 구현 객체)</sub> 반환
    - 실제 반복문 동작 대상

##### 2. 다음 값 필요 시
- `next` <sub>(메서드)</sub> 호출
  - 값 객체 반환

##### 3. `{done: Boolean, value: any}` <sub>(객체)</sub>
- `next` <sub>(메서드)</sub> 반환 값
- `done` <sub>(반복 종료 여부)</sub>
  - `true`
    - 반복 종료
  - `false`
    - 다음 값 → `value` 저장

##### `range` <sub>(객체)</sub>
- 숫자 간격 표현
```javascript
let range = {
  from: 1,
  to: 5
};

// ①
// 최초 [Symbol.iterator] (메서드) 호출
// - iterator (객체) 반환
//   - 실제 반복문 동작 대상
range[Symbol.iterator] = function() {
  return {
    current: this.from,
    last: this.to,

    // ②
    // 각 반복 시 next (메서드) 호출
    // - 값 객체 반환
    next() {

      // ③
      // {done: …, value: …} (객체)
      // - 값 저장 · 반복 여부 결정
      if (this.current <= this.last) {
        return {done: false, value: this.current++};
      } else {
        return {done: true};
      }
    }
  };
};

// 결과
for (let num of range) {
  alert(num); // 1, 2, 3, 4, 5
}
```

##### _Separation of concern_ <sub>(SoC)</sub>
- '관심사 분리'
  - 이터러블 <sub>(객체)</sub> 핵심

##### `range` <sub>(객체)</sub>
- `next` <sub>(메서드)</sub> 無
- `[Symbol.iterator]` <sub>(메서드)</sub> 호출 시
  - iterator <sub>(객체)</sub> 반환

##### iterator <sub>(객체)</sub>
- `next` <sub>(메서드)</sub> 구현
  - 반복 내 사용 값 생성

##### 객체 분리 실현
- 반복 대상 객체 <sub>(`range`)</sub>
- iterator <sub>(객체)</sub>

##### 반복 대상 객체 <sub>(`range`)</sub> + iterator <sub>(객체)</sub>
- 코드 단순화
```javascript
let range = {
  from: 1,
  to: 5,
  current: 0,

  [Symbol.iterator]() {
    this.current = this.from;
    return this;
  },

  next() {
    if (this.current <= this.to) {
      return {done: false, value: this.current++};
    } else {
      return {done: true};
    }
  }
};

for (let num of range) {
  alert(num); // 1, 2, 3, 4, 5
}
```

##### `range[Symbol.iterator]` <sub>(메서드)</sub>
- `range` <sub>(객체)</sub> 자체 반환
  - `next` <sub>(객체)</sub> 구현
  - `this.current` <sub>(프로퍼티)</sub>
    - 반복 진행 값 저장
  - 코드량 ↓

##### `for…of` <sub>(반복문)</sub> 동시 2개 사용 불가능 <sub>(단점)</sub>
- iterator <sub>(객체)</sub> 1개 有 <sub>(반복 대상 객체 · `range`)</sub>
  - 두 반복문 반복 상태 공유
- 반복문 동시 2개 사용 경우
  - 굉장히 드물게 발생

<br />

<img src="../../images/commons/icons/circle-exclamation-solid.svg" /> **무한 반복**

##### 무한 반복 가능
- ex\) `range.to` → `Infinity` 할당
- 무수히 많은 의사 난수 생성 가능

##### `next` <sub>(메서드)</sub> 제약사항 無
- 값 무한 반환 가능 <sub>(정상 동작)</sub>
  - 반복 중단 가능 <sub>(`break` 지시자)</sub>

<br />

### 문자열 == 이터러블 <sub>(객체)</sub>

##### 배열 · 문자열
- 내장 이터러블 <sub>(객체)</sub>
  - 최다 사용
```javascript
// for…of
// - 문자열 각 글자 순회
for (let char of "test") {

  // 글자 하나당 한 번 실행 (총 4회 호출)
  // - t, e, s, t (차례대로 출력)
  alert( char );
}

// 서로게이트 쌍 잘 동작
let str = '𝒳😂';
for (let char of str) {

  // 𝒳, 😂 (차례대로 출력)
  alert( char );
}
```

### 이터레이터 <sub>(객체)</sub> 명시적 호출

##### 이터레이터 명시적 호출 경우
- 거의 無

##### `for…of` <sub>(반복문)</sub> 보다 반복 과정 더 잘 통제
- 반복 과정 여러 개로 쪼개기
  1. 반복 시작
  2. 잠시 멈춰 다른 작업
  3. 다시 반복 시작
  4. 기타 작업 등
```javascript
/* 이터레이터 (객체) 직접 호출하여 순회 */
// 문자열 이터레이터 생성 후
// - '수동으로' 값 가져옴
let str = "Hello";

// for…of 사용 동일 작업
// for (let char of str) alert(char);
let iterator = str[Symbol.iterator]();

while (true) {
  let result = iterator.next();
  if (result.done) break;

  // 글자 하나씩 출력
  alert(result.value);
}
```

### 이터러블 vs 유사 배열

##### 이터러블 <sub>(iterable)</sub>
- `[Symbol.iterator]` <sub>(메서드)</sub> 구현 객체

##### 유사 배열
- 인덱스 · `length` <sub>(프로퍼티)</sub> 보유
- 배열처럼 보이는 객체

##### 호스트 <sub>(브라우저 등)</sub> 환경 내 JS 사용 시
- 2가지 · 혼합 객체 종종 사용
- 혼합 객체 <sub>(이터러블 + 유사 배열)</sub>
  - `for…of` <sub>(반복문)</sub> 사용 가능
  - 숫자 인덱스 · `length` <sub>(프로퍼티)</sub>
  - ex\) 문자열

<br />

##### 이터러블 <sub>(객체)</sub> ≠ 유사 배열 객체
```javascript
// 유사 배열 (객체)
// - 인덱스 · length 프로퍼티
// - 이터러블 X
let arrayLike = {
  0: "Hello",
  1: "World",
  length: 2
};

// [Symbol.iterator] (메서드) 부재
// - 에러
for (let item of arrayLike) {}
```

##### 이터러블 · 유사 배열 ≠ 배열
- 배열 메서드 미지원
  - 불편함 초래

### `Array.from`

##### 이터러블 · 유사 배열 → 배열
- 배열 메서드 사용 가능
- 유사 배열
  - 이터러블 속성 이용 가능
```javascript
/* 유사 배열 → 배열 */
let arrayLike = {
  0: "Hello",
  1: "World",
  length: 2
};

/*
 객체 전달 받아 이터러블 · 유사 배열 여부 조사
 인수 : 이터러블 · 유사 배열
 - 새 배열 생성 후
   - 객체 내 모든 요소 → 새롭게 만든 배열로 복사
 */
// 배열 메서드 정상 동작
let arr1 = Array.from(arrayLike);
alert(arr.pop());
```
```javascript
/* 이터러블 (range 예시 객체) → 배열 */
let arr2 = Array.from(range);

// 배열 문자열 형 변환 정상 동작
// - toString (배열 메서드)
alert(arr); // 1,2,3,4,5
```

##### 문법
```javascript
Array.from(obj[, mapFn, thisArg])
```

##### 2번째 인수 <sub>(`mapFn`)</sub>
- 선택적
- `obj` <sub>(새 배열)</sub> 요소 추가 전
  - 각 요소 대상 `mapFn` <sub>(함수)</sub> 적용

##### 3번째 인수 <sub>(`thisArg`)</sub>
- 각 요소 `this` 지정
```javascript
/* range 예시 객체 */
// 각 숫자 제곱
let arr = Array.from(range, num => num * num);
alert(arr); // 1,4,9,16,25
```
```javascript
/* 문자열 → 배열 */
let str = '𝒳😂';

// str 분해 → 글자 담긴 배열
let chars1 = Array.from(str);

alert(chars1[0]);     // 𝒳
alert(chars1[1]);     // 😂
alert(chars1.length); // 2

// 문자열 자체 이터러블 속성 이용해 동작
// - String.split 과 차이
// - for…of 같이 서로게이트 쌍 정상 적용
let chars2 = [];

// Array.from 내부
// - 동일 반복문 동작
for (let char of str) {
  chars2.push(char);
}

alert(chars2[0]);     // 𝒳
alert(chars2[1]);     // 😂
alert(chars2.length); // 2
```

##### 서로게이트 쌍 처리 `slice`
- 직접 구현
```javascript
function slice(str, start, end) {
  return Array.from(str).slice(start, end).join('');
}

let str = '𝒳😂𩷶';

alert( slice(str, 1, 3) ); // 😂𩷶

// 순수 내장 메서드
// - 서로게이트 쌍 미지원
//   - 쓰레깃값 출력 (영역 다른 특수 값)
alert( str.slice(1, 3) );
```

<br />

요약
====

##### 이터러블 <sub>(객체)</sub>
- `for…of` <sub>(반복문)</sub> 사용 가능 객체
- `[Symbol.iterator]` <sub>(메서드)</sub> 구현 필수
  - 이터레이터 <sub>(객체)</sub> 반환
    - 반복 과정 처리

##### 이터레이터 <sub>(객체)</sub>
- `next` <sub>(메서드)</sub> 구현 필수
  - 특정 객체 반환 필수
```javascript
{
  // 반복 종료 여부
  done: Boolean,

  // 다음 값
  value: any
}
```

##### `[Symbol.iterator]` <sub>(메서드)</sub>
- `for…of` <sub>(반복문)</sub> 의해 자동 호출
- 개발자 : 명시적 호출 가능
- 내장 이터러블 <sub>(객체)</sub> : 메서드 구현
  - 문자열
  - 배열
  - 기타 등등

##### 문자열 이터레이터
- 서로게이트 쌍 지원

##### 유사 배열 객체
- 인덱스 보유
- `length` <sub>(프로퍼티)</sub> 보유
- 다양한 프로퍼티 · 메서드
- 배열 내장 메서드 X

##### 대다수 메서드 동작 대상
- '진짜' 배열 X
- 이터러블 · 유사 배열 객체
  - 더 추상적

##### `array.from(obj[, mapFn, thisArg])`
- `obj` <sub>(이터러블 · 유사 배열 객체)</sub> → 배열
  - 배열 메서드 사용 가능
- `[mapFn]` · `[thisArg]`
  - 각 요소 대상 함수 적용
